---
layout      : single
title       : "âš¾Chapter01 KBO íƒ€ì OPS ì˜ˆì¸¡ 2 - ë°ì´í„° ì „ì²˜ë¦¬, ëª¨ë¸ êµ¬ì¶•ê³¼ ê²€ì¦"
categories  : data
tag         : [dacon, python, analysis] 
toc : true
toc_label: "Contents"
toc_icon	: "list"
toc_sticky : True
author_profile : false
sidebar:
    nav : "docs"
typora-copy-images-to: ..\images\2022-04-08-dacon-2st
---
<img src="/images/2022-04-08-dacon-1st/image-20220408102310504.png" alt="image-20220408102349708" style="zoom:50%;" />
{: .text-center}

## 3_ ë°ì´í„° ì „ì²˜ë¦¬[ğŸ“‘](#contents)<a id='3'></a>

* **ë°ì´í„° ì „ì²˜ë¦¬** : ë¶„ì„ê³¼ ì˜ˆì¸¡ ëª¨ë¸ë§ ì‘ì—…ì„ ì§„í–‰í•  ìˆ˜ ìˆê²Œ ë°ì´í„°ë¥¼ ì •ì œí•˜ê³  ë³€í™˜í•˜ëŠ” ëª¨ë“  ì‘ì—…ì„ ì˜ë¯¸í•¨.
  * ë°ì´í„°ê°€ ë¹„ì–´ ìˆëŠ” ê²°ì¸¡ì¹˜ì˜ ì²˜ë¦¬
  * ì˜ëª»ëœ ë°ì´í„° ë¼ê³  íŒë‹¨ë˜ëŠ” ë°ì´í„°ì˜ ì˜¤ë¥˜ ì²˜ë¦¬
  * ê·œì • íƒ€ìˆ˜ ì •ì˜
  * ì‹œê°„ ë³€ìˆ˜ë¥¼ í¬í•¨í•œ ì¶”ê°€ ë³€ìˆ˜ ìƒì„±
  * ìµœì¢… ë°ì´í„° ì •ì œ

### 3_1 ê²°ì¸¡ì¹˜ ì²˜ë¦¬ ë° ë°ì´í„° ì˜¤ë¥˜ ì²˜ë¦¬

* ë°ì´í„° ìˆ˜ì§‘ ê³¼ì •ì´ë‚˜ í™˜ê²½ ë¬¸ì œë¡œ ì¸í•´ ê²°ì¸¡ì¹˜ë‚˜ ì˜¤ë¥˜ ë°œìƒ ê°€ëŠ¥

* ê²°ì¸¡ì¹˜ ë¬¸ì œë¥¼ ë¨¼ì € í•´ê²°í•˜ê¸° ìœ„í•´ ë‹¤ìŒì˜ ë°ì´í„°ì— ëŒ€í•´ ê²°ì¸¡ì¹˜ ì²˜ë¦¬ë¥¼ ë¨¼ì € ìˆ˜í–‰

  * ì •ê·œì‹œì¦Œ ë°ì´í„°ì™€ ì¼ë³„ ë°ì´í„°
  * í”„ë¦¬ì‹œì¦Œ ë°ì´í„°

* ê²°ì¸¡ì¹˜ ê°œìˆ˜ í™•ì¸

  ```python
  pd.DataFrame(regular_season_df.isna().sum()).transpose()
  
  # ì‹¤í–‰ê²°ê³¼
  	batter_id	batter_name	year	team	avg	G	AB	R	H	2B	...	position	career	starting_salary	OPS	weight	height	weight_per_height	pos	hit_way	country
  0	0	0	0	0	26	0	0	0	0	0	...	802	0	1076	26	802	802	802	802	802	0
  1 rows Ã— 35 columns
  ```

* í™•ì¸ ê²°ê³¼ íƒ€ìœ¨(avg), ì¥íƒ€ìœ¨(SLG), ì¶œë£¨ìœ¨(OBP) ë“±ì˜ ë³€ìˆ˜ì— ê²°ì¸¡ì¹˜ê°€ ì¡´ì¬

* ë°ì´í„° íƒ€ì…ì— ë”°ë¼ ê²°ì¸¡ì¹˜ ì²˜ë¦¬ ë°©ë²•ì´ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ìˆ˜ì¹˜í˜• íƒ€ì…ì˜ ë³€ìˆ˜ë§Œ ë”°ë¡œ ì¶”ì¶œí•´ ê²°ì¸¡ì¹˜ë¥¼ ì²˜ë¦¬

* ìˆ˜ì¹˜í˜• íƒ€ì… ë³€ìˆ˜ì˜ ê²°ì¸¡ì¹˜ í˜„í™©ì„ í™•ì¸í•˜ê¸° ìœ„í•´ ê²°ì¸¡ì¹˜ê°€ ì¡´ì¬í•˜ëŠ” í–‰ì„ ì¶œë ¥

* ì—°ë„ë³„ í‰ê·  íƒ€ìœ¨

  ```python
  # ìˆ˜ì¹˜í˜• íƒ€ì…ì˜ ë³€ìˆ˜ ì €ì¥
  numerics = [
      'int16', 'int32', 'int64', 'float16', 'float32', 'float64'] # ëª¨ë“  numeric(ìˆ˜ì¹˜í˜•) íƒ€ì…
  num_cols = regular_season_df.select_dtypes(include=numerics).columns
  
  # ìˆ˜ì¹˜í˜• íƒ€ì… ë³€ìˆ˜ ì¤‘ ê²°ì¸¡ì¹˜ê°€ í•˜ë‚˜ë¼ë„ ì¡´ì¬í•˜ëŠ” í–‰ ì¶œë ¥
  # isna().sum(axis=1) -> ì—´ ê¸°ì¤€ì˜ ê²°ì¸¡ì¹˜ ê°œìˆ˜
  # df.loc[]ë¥¼ í†µí•´ ê²°ì¸¡ì¹˜ 0ê°œ ì´ìƒ ë°ì´í„°ë¥¼ ì¶”ì¶œ
  regular_season_df.loc[regular_season_df[num_cols].isna().sum(axis=1) > 0,num_cols].head()
  
  # ì‹¤í–‰ ê²°ê³¼
  	batter_id	year	avg	G	AB	R	H	2B	3B	HR	...	SO	GDP	SLG	OBP	E	starting_salary	OPS	weight	height	weight_per_height
  0	0	2018	0.339	50	183	27	62	9	0	8	...	25	3	0.519000	0.383000	9	NaN	0.902000	93.0	1.0	93.0
  12	138	2005	0.127	39	63	9	8	2	0	0	...	15	1	0.158730	0.256757	3	NaN	0.415487	NaN	NaN	NaN
  13	138	2006	0.139	37	36	6	5	2	0	0	...	14	0	0.194444	0.326087	4	NaN	0.520531	NaN	NaN	NaN
  14	138	2007	0.000	8	4	3	0	0	0	0	...	2	1	0.000000	0.000000	0	NaN	0.000000	NaN	NaN	NaN
  15	138	2008	0.000	2	1	0	0	0	0	0	...	0	0	0.000000	0.000000	0	NaN	0.000000	NaN	NaN	NaN
  5 rows Ã— 26 columns
  ```

* ì£¼ì–´ì§„ ë°ì´í„°ì—ì„œ ë³€ìˆ˜ GëŠ” ì„ ìˆ˜ê°€ ë›´ ê²½ê¸° ìˆ˜ë¥¼ ì˜ë¯¸í•¨.

* ë›´ ê²½ê¸°ê°€ ì ì–´ ì„±ì ì„ ì‚°ì¶œ í•˜ì§€ ëª»í•˜ëŠ” ê²½ìš°ì— ê²°ì¸¡ì¹˜ê°€ ë°œìƒí•˜ëŠ” ê²ƒì´ í™•ì¸ë¨.

* ë”°ë¼ì„œ ì •ê·œì‹œì¦Œê³¼ ì¼ë³„ ë°ì´í„°, í”„ë¦¬ì‹œì¦Œ ë°ì´í„° ëª¨ë‘ ê²°ì¸¡ì¹˜ë¥¼ 0ìœ¼ë¡œ ëŒ€ì²´í•¨.

* ì •ê·œ ì‹œì¦Œ ë°ì´í„°ì˜ ê²°ì¸¡ì¹˜ë¥¼ 0ìœ¼ë¡œ ëŒ€ì²´

  ```python
  # ìˆ˜ì¹˜í˜• ë³€ìˆ˜ì— í¬í•¨ë˜ëŠ” ë°ì´í„° íƒ€ì… ì„ ì •
  numerics = ['int16', 'int32', 'int64', 'float16', 'float32', 'float64']
  
  # ì •ê·œ ì‹œì¦Œ ë°ì´í„°ì—ì„œ ê²°ì¸¡ì¹˜ë¥¼ 0ìœ¼ë¡œ ì±„ìš°ê¸°
  regular_season_df[regular_season_df.select_dtypes(include=numerics).columns] = \
      regular_season_df[regular_season_df.select_dtypes(include=numerics).columns].fillna(0)
  regular_season_df
  
  # ì‹¤í–‰ ê²°ê³¼
  	batter_id	batter_name	year	team	avg	G	AB	R	H	2B	...	position	career	starting_salary	OPS	weight	height	weight_per_height	pos	hit_way	country
  0	0	ê°€ë¥´ì‹œì•„	2018	LG	0.339	50	183	27	62	9	...	ë‚´ì•¼ìˆ˜(ìš°íˆ¬ìš°íƒ€)	ì¿ ë°” Ciego de Avila Maximo Gomez Baez(ëŒ€)	0.0	0.902	93.0	1.0	93.0	ë‚´ì•¼ìˆ˜	ìš°íƒ€	foreign
  1	1	ê°•ê²½í•™	2011	í•œí™”	0.000	2	1	0	0	0	...	ë‚´ì•¼ìˆ˜(ìš°íˆ¬ì¢Œíƒ€)	ê´‘ì£¼ëŒ€ì„±ì´ˆ-ê´‘ì£¼ë™ì„±ì¤‘-ê´‘ì£¼ë™ì„±ê³ 	10000.0	0.000	72.0	1.0	72.0	ë‚´ì•¼ìˆ˜	ì¢Œíƒ€	korean
  2	1	ê°•ê²½í•™	2014	í•œí™”	0.221	41	86	11	19	2	...	ë‚´ì•¼ìˆ˜(ìš°íˆ¬ì¢Œíƒ€)	ê´‘ì£¼ëŒ€ì„±ì´ˆ-ê´‘ì£¼ë™ì„±ì¤‘-ê´‘ì£¼ë™ì„±ê³ 	10000.0	0.686	72.0	1.0	72.0	ë‚´ì•¼ìˆ˜	ì¢Œíƒ€	korean
  3	1	ê°•ê²½í•™	2015	í•œí™”	0.257	120	311	50	80	7	...	ë‚´ì•¼ìˆ˜(ìš°íˆ¬ì¢Œíƒ€)	ê´‘ì£¼ëŒ€ì„±ì´ˆ-ê´‘ì£¼ë™ì„±ì¤‘-ê´‘ì£¼ë™ì„±ê³ 	10000.0	0.673	72.0	1.0	72.0	ë‚´ì•¼ìˆ˜	ì¢Œíƒ€	korean
  4	1	ê°•ê²½í•™	2016	í•œí™”	0.158	46	101	16	16	3	...	ë‚´ì•¼ìˆ˜(ìš°íˆ¬ì¢Œíƒ€)	ê´‘ì£¼ëŒ€ì„±ì´ˆ-ê´‘ì£¼ë™ì„±ì¤‘-ê´‘ì£¼ë™ì„±ê³ 	10000.0	0.489	72.0	1.0	72.0	ë‚´ì•¼ìˆ˜	ì¢Œíƒ€	korean
  ...	...	...	...	...	...	...	...	...	...	...	...	...	...	...	...	...	...	...	...	...	...
  2449	344	í™©ì§„ìˆ˜	2014	ë¡¯ë°	0.000	5	5	0	0	0	...	ë‚´ì•¼ìˆ˜(ìš°íˆ¬ì–‘íƒ€)	ì„ì²œì´ˆ-ëŒ€í—Œì¤‘-ê³µì£¼ê³ 	4000.0	0.000	82.0	1.0	82.0	ë‚´ì•¼ìˆ˜	ì–‘íƒ€	korean
  2450	344	í™©ì§„ìˆ˜	2015	ë¡¯ë°	0.000	2	2	0	0	0	...	ë‚´ì•¼ìˆ˜(ìš°íˆ¬ì–‘íƒ€)	ì„ì²œì´ˆ-ëŒ€í—Œì¤‘-ê³µì£¼ê³ 	4000.0	0.000	82.0	1.0	82.0	ë‚´ì•¼ìˆ˜	ì–‘íƒ€	korean
  2451	344	í™©ì§„ìˆ˜	2016	ë¡¯ë°	0.000	11	10	2	0	0	...	ë‚´ì•¼ìˆ˜(ìš°íˆ¬ì–‘íƒ€)	ì„ì²œì´ˆ-ëŒ€í—Œì¤‘-ê³µì£¼ê³ 	4000.0	0.000	82.0	1.0	82.0	ë‚´ì•¼ìˆ˜	ì–‘íƒ€	korean
  2452	344	í™©ì§„ìˆ˜	2017	ë¡¯ë°	0.291	60	117	18	34	6	...	ë‚´ì•¼ìˆ˜(ìš°íˆ¬ì–‘íƒ€)	ì„ì²œì´ˆ-ëŒ€í—Œì¤‘-ê³µì£¼ê³ 	4000.0	0.761	82.0	1.0	82.0	ë‚´ì•¼ìˆ˜	ì–‘íƒ€	korean
  2453	344	í™©ì§„ìˆ˜	2018	ë¡¯ë°	0.167	18	24	6	4	1	...	ë‚´ì•¼ìˆ˜(ìš°íˆ¬ì–‘íƒ€)	ì„ì²œì´ˆ-ëŒ€í—Œì¤‘-ê³µì£¼ê³ 	4000.0	0.564	82.0	1.0	82.0	ë‚´ì•¼ìˆ˜	ì–‘íƒ€	korean
  2454 rows Ã— 35 columns
  ```

* ë¨¼ì € `numerics`ë¼ëŠ” ì´ë¦„ì˜ ë¦¬ìŠ¤íŠ¸ë¡œ ìˆ˜ì¹˜í˜• ë³€ìˆ˜ì— í•´ë‹¹í•˜ëŠ” ë°ì´í„° íƒ€ì…ì„ ì„ ì •

* ì´ë¥¼ ì´ìš©í•´ ìˆ˜ì¹˜í˜• ë³€ìˆ˜ ì¤‘ ê²°ì¸¡ì¹˜ëŠ” ëª¨ë‘ 0ìœ¼ë¡œ ë°”ê¿” ê²°ì¸¡ì¹˜ ì²˜ë¦¬ë¥¼ ì§„í–‰

* ì¼ë³„ ë°ì´í„°ì˜ ê²°ì¸¡ì¹˜ë¥¼ 0ìœ¼ë¡œ ëŒ€ì²´

  ```python
  # ì¼ë³„ ë°ì´í„°ì—ì„œ ê²°ì¸¡ì¹˜ë¥¼ 0ìœ¼ë¡œ ì±„ìš°ê¸°
  day_by_day_df[day_by_day_df.select_dtypes(include=numerics).columns] = \
      day_by_day_df[day_by_day_df.select_dtypes(include=numerics).columns].fillna(0)
  day_by_day_df
  
  # ì‹¤í–‰ ê²°ê³¼
  	batter_id	batter_name	date	opposing_team	avg1	AB	R	H	2B	3B	...	RBI	SB	CS	BB	HBP	SO	GDP	avg2	year	month
  0	0	ê°€ë¥´ì‹œì•„	3.24	NC	0.333	3	1	1	0	0	...	0	0	0	1	0	1	0	0.333	2018	3
  1	0	ê°€ë¥´ì‹œì•„	3.25	NC	0.000	4	0	0	0	0	...	0	0	0	0	0	1	0	0.143	2018	3
  2	0	ê°€ë¥´ì‹œì•„	3.27	ë„¥ì„¼	0.200	5	0	1	0	0	...	0	0	0	0	0	0	0	0.167	2018	3
  3	0	ê°€ë¥´ì‹œì•„	3.28	ë„¥ì„¼	0.200	5	1	1	0	0	...	1	0	0	0	0	0	0	0.176	2018	3
  4	0	ê°€ë¥´ì‹œì•„	3.29	ë„¥ì„¼	0.250	4	0	1	0	0	...	3	0	0	0	0	0	1	0.190	2018	3
  ...	...	...	...	...	...	...	...	...	...	...	...	...	...	...	...	...	...	...	...	...	...
  112268	344	í™©ì§„ìˆ˜	6.23	LG	-	0	0	0	0	0	...	0	0	0	1	0	0	0	0.158	2018	6
  112269	344	í™©ì§„ìˆ˜	6.26	ë„¥ì„¼	0.000	1	0	0	0	0	...	0	0	0	0	0	1	0	0.150	2018	6
  112270	344	í™©ì§„ìˆ˜	6.27	ë„¥ì„¼	0.500	2	1	1	1	0	...	0	0	0	0	0	1	0	0.182	2018	6
  112271	344	í™©ì§„ìˆ˜	6.28	ë„¥ì„¼	-	0	0	0	0	0	...	0	0	0	0	0	0	0	0.182	2018	6
  112272	344	í™©ì§„ìˆ˜	6.30	í•œí™”	0.000	2	0	0	0	0	...	0	0	0	0	0	0	0	0.167	2018	6
  112273 rows Ã— 21 columns
  ```

* ê°™ì€ ì›ë¦¬ë¥¼ ì´ìš©í•´ ì¼ë³„ ë°ì´í„°ì˜ ê²°ì¸¡ì¹˜ë„ ì²˜ë¦¬

* ìˆ˜ì¹˜í˜• ë³€ìˆ˜ì— ëŒ€í•´ ê²°ì¸¡ì¹˜ë¥¼ 0ìœ¼ë¡œ êµì²´

* í”„ë¦¬ì‹œì¦Œ ë°ì´í„°ì˜ ê²°ì¸¡ì¹˜ë¥¼ 0ìœ¼ë¡œ ëŒ€ì²´

  ```python
  # í”„ë¦¬ì‹œì¦Œ ë°ì´í„°ì—ì„œ ê²°ì¸¡ì¹˜ë¥¼ 0ìœ¼ë¡œ ì±„ìš°ê¸°
  preseason_df[preseason_df.select_dtypes(include=numerics).columns] = \
      preseason_df[preseason_df.select_dtypes(include=numerics).columns].fillna(0)
  preseason_df
  
  # ì‹¤í–‰ ê²°ê³¼
  	batter_id	batter_name	year	team	avg	G	AB	R	H	2B	...	SLG	OBP	E	height/weight	year_born	position	career	starting_salary	OPS	new_idx
  0	0	ê°€ë¥´ì‹œì•„	2018	LG	0.350	7	20	1	7	1	...	0.550	0.409	1	177cm/93kg	1985ë…„ 04ì›” 12ì¼	ë‚´ì•¼ìˆ˜(ìš°íˆ¬ìš°íƒ€)	ì¿ ë°” Ciego de Avila Maximo Gomez Baez(ëŒ€)	NaN	0.959	ê°€ë¥´ì‹œì•„2018
  1	1	ê°•ê²½í•™	2011	í•œí™”	0.000	4	2	2	0	0	...	0.000	0.500	0	180cm/72kg	1992ë…„ 08ì›” 11ì¼	ë‚´ì•¼ìˆ˜(ìš°íˆ¬ì¢Œíƒ€)	ê´‘ì£¼ëŒ€ì„±ì´ˆ-ê´‘ì£¼ë™ì„±ì¤‘-ê´‘ì£¼ë™ì„±ê³ 	10000ë§Œì›	0.500	ê°•ê²½í•™2011
  2	1	ê°•ê²½í•™	2014	í•œí™”	-	4	0	2	0	0	...	0.000	0.000	0	180cm/72kg	1992ë…„ 08ì›” 11ì¼	ë‚´ì•¼ìˆ˜(ìš°íˆ¬ì¢Œíƒ€)	ê´‘ì£¼ëŒ€ì„±ì´ˆ-ê´‘ì£¼ë™ì„±ì¤‘-ê´‘ì£¼ë™ì„±ê³ 	10000ë§Œì›	0.000	ê°•ê²½í•™2014
  3	1	ê°•ê²½í•™	2015	í•œí™”	0.130	10	23	3	3	0	...	0.130	0.286	2	180cm/72kg	1992ë…„ 08ì›” 11ì¼	ë‚´ì•¼ìˆ˜(ìš°íˆ¬ì¢Œíƒ€)	ê´‘ì£¼ëŒ€ì„±ì´ˆ-ê´‘ì£¼ë™ì„±ì¤‘-ê´‘ì£¼ë™ì„±ê³ 	10000ë§Œì›	0.416	ê°•ê²½í•™2015
  4	1	ê°•ê²½í•™	2016	í•œí™”	0.188	14	32	4	6	1	...	0.281	0.212	0	180cm/72kg	1992ë…„ 08ì›” 11ì¼	ë‚´ì•¼ìˆ˜(ìš°íˆ¬ì¢Œíƒ€)	ê´‘ì£¼ëŒ€ì„±ì´ˆ-ê´‘ì£¼ë™ì„±ì¤‘-ê´‘ì£¼ë™ì„±ê³ 	10000ë§Œì›	0.493	ê°•ê²½í•™2016
  ...	...	...	...	...	...	...	...	...	...	...	...	...	...	...	...	...	...	...	...	...	...
  1388	342	í™©ì¬ê· 	2014	ë¡¯ë°	0.407	10	27	3	11	2	...	0.593	0.448	1	183cm/96kg	1987ë…„ 07ì›” 28ì¼	ë‚´ì•¼ìˆ˜(ìš°íˆ¬ìš°íƒ€)	ì‚¬ë‹¹ì´ˆ-ì´ìˆ˜ì¤‘-ê²½ê¸°ê³ -í˜„ëŒ€-ìš°ë¦¬-íˆì–´ë¡œì¦ˆ-ë„¥ì„¼-ë¡¯ë°-ìƒŒí”„ë€ì‹œìŠ¤ì½”	6000ë§Œì›	1.041	í™©ì¬ê· 2014
  1389	342	í™©ì¬ê· 	2015	ë¡¯ë°	0.333	11	30	8	10	3	...	0.433	0.389	0	183cm/96kg	1987ë…„ 07ì›” 28ì¼	ë‚´ì•¼ìˆ˜(ìš°íˆ¬ìš°íƒ€)	ì‚¬ë‹¹ì´ˆ-ì´ìˆ˜ì¤‘-ê²½ê¸°ê³ -í˜„ëŒ€-ìš°ë¦¬-íˆì–´ë¡œì¦ˆ-ë„¥ì„¼-ë¡¯ë°-ìƒŒí”„ë€ì‹œìŠ¤ì½”	6000ë§Œì›	0.822	í™©ì¬ê· 2015
  1390	342	í™©ì¬ê· 	2016	ë¡¯ë°	0.310	16	42	8	13	3	...	0.429	0.370	1	183cm/96kg	1987ë…„ 07ì›” 28ì¼	ë‚´ì•¼ìˆ˜(ìš°íˆ¬ìš°íƒ€)	ì‚¬ë‹¹ì´ˆ-ì´ìˆ˜ì¤‘-ê²½ê¸°ê³ -í˜„ëŒ€-ìš°ë¦¬-íˆì–´ë¡œì¦ˆ-ë„¥ì„¼-ë¡¯ë°-ìƒŒí”„ë€ì‹œìŠ¤ì½”	6000ë§Œì›	0.799	í™©ì¬ê· 2016
  1391	342	í™©ì¬ê· 	2018	KT	0.250	6	16	3	4	1	...	0.500	0.333	3	183cm/96kg	1987ë…„ 07ì›” 28ì¼	ë‚´ì•¼ìˆ˜(ìš°íˆ¬ìš°íƒ€)	ì‚¬ë‹¹ì´ˆ-ì´ìˆ˜ì¤‘-ê²½ê¸°ê³ -í˜„ëŒ€-ìš°ë¦¬-íˆì–´ë¡œì¦ˆ-ë„¥ì„¼-ë¡¯ë°-ìƒŒí”„ë€ì‹œìŠ¤ì½”	6000ë§Œì›	0.833	í™©ì¬ê· 2018
  1392	344	í™©ì§„ìˆ˜	2014	ë¡¯ë°	0.000	1	1	1	0	0	...	0.000	0.000	0	181cm/82kg	1989ë…„ 02ì›” 15ì¼	ë‚´ì•¼ìˆ˜(ìš°íˆ¬ì–‘íƒ€)	ì„ì²œì´ˆ-ëŒ€í—Œì¤‘-ê³µì£¼ê³ 	4000ë§Œì›	0.000	í™©ì§„ìˆ˜2014
  1393 rows Ã— 30 columns
  ```

* ì •ê·œì‹œì¦Œ ë°ì´í„°, ì¼ë³„ ë°ì´í„°ì™€ ê°™ì€ ë°©ì‹ìœ¼ë¡œ í”„ë¦¬ì‹œì¦Œ ë°ì´í„° ì—­ì‹œ ìˆ˜ì¹˜í˜• ë³€ìˆ˜ì˜ ê²°ì¸¡ì¹˜ ì²˜ë¦¬

* ì§€ê¸ˆê¹Œì§€ ìˆ˜ì¹˜í˜• ë³€ìˆ˜ ì¤‘ ê²°ì¸¡ì¹˜ê°€ ì¡´ì¬í•˜ëŠ” í–‰ì€ ëª¨ë‘ 0ìœ¼ë¡œ ëŒ€ì²´í•œë‹¤ëŠ” ê·œì¹™ìœ¼ë¡œ 3ê°€ì§€ ë°ì´í„°ë¥¼ ëª¨ë‘ ë™ì¼í•˜ê²Œ ì •ì œí•¨.

* ë‹¤ìŒìœ¼ë¡œ ìˆ˜ì¹˜í˜• ë³€ìˆ˜ê°€ ì•„ë‹Œ ë°ì´í„°ì˜ ê²°ì¸¡ì¹˜ë¥¼ í™•ì¸

* ìˆ˜ì¹˜í˜• ë³€ìˆ˜ì˜ ê²°ì¸¡ì¹˜ ì²˜ë¦¬ì™€ ë§ˆì°¬ê°€ì§€ë¡œ ê²°ì¸¡ì¹˜ í˜„í™©ì„ íŒŒì•…í•œ í›„ ê·¸ì— ë”°ë¥¸ ê²°ì¸¡ì¹˜ ì²˜ë¦¬ ë°©ë²•ì„ ê³ ì•ˆ

* ìˆ˜ì¹˜í˜•ì´ ì•„ë‹Œ ë³€ìˆ˜ì˜ ê²°ì¸¡ì¹˜

  ```python
  # ìˆ˜ì¹˜í˜•ì´ ì•„ë‹Œ ë³€ìˆ˜ ì¶”ì¶œ
  not_num_cols = [x for x in regular_season_df.columns if x not in num_cols]
  
  # ìˆ˜ì¹˜í˜•ì´ ì•„ë‹Œ ë³€ìˆ˜ ì¤‘ ê²°ì¸¡ì¹˜ê°€ í•˜ë‚˜ë¼ë„ ì¡´ì¬í•˜ëŠ” í–‰ ì¶œë ¥
  # isna().sum(axis=1) -> ì—´ ê¸°ì¤€ì˜ ê²°ì¸¡ì¹˜ ê°œìˆ˜
  # df.loc[]ë¥¼ í†µí•´ ê²°ì¸¡ì¹˜ 0ê°œ ì´ìƒ ë°ì´í„°ë¥¼ ì¶”ì¶œ
  regular_season_df.loc[regular_season_df[not_num_cols].isna().sum(axis=1) > 0,
                        not_num_cols].head()
  
  # ì‹¤í–‰ ê²°ê³¼
  	batter_name	team	height/weight	year_born	position	career	pos	hit_way	country
  12	ë°±ìŠ¹ë£¡	í•œí™”	NaN	1982ë…„ 08ì›” 16ì¼	NaN	ì‚¬ì§ì´ˆ(ë¶€ì‚°ê·¹ë™ë¦¬í‹€)-ì‚¬ì§ì¤‘-ê²½ë‚¨ìƒê³ -ê²½ì„±ëŒ€-í•œí™”-ë„¥ì„¼	NaN	NaN	korean
  13	ë°±ìŠ¹ë£¡	í•œí™”	NaN	1982ë…„ 08ì›” 16ì¼	NaN	ì‚¬ì§ì´ˆ(ë¶€ì‚°ê·¹ë™ë¦¬í‹€)-ì‚¬ì§ì¤‘-ê²½ë‚¨ìƒê³ -ê²½ì„±ëŒ€-í•œí™”-ë„¥ì„¼	NaN	NaN	korean
  14	ë°±ìŠ¹ë£¡	í•œí™”	NaN	1982ë…„ 08ì›” 16ì¼	NaN	ì‚¬ì§ì´ˆ(ë¶€ì‚°ê·¹ë™ë¦¬í‹€)-ì‚¬ì§ì¤‘-ê²½ë‚¨ìƒê³ -ê²½ì„±ëŒ€-í•œí™”-ë„¥ì„¼	NaN	NaN	korean
  15	ë°±ìŠ¹ë£¡	í•œí™”	NaN	1982ë…„ 08ì›” 16ì¼	NaN	ì‚¬ì§ì´ˆ(ë¶€ì‚°ê·¹ë™ë¦¬í‹€)-ì‚¬ì§ì¤‘-ê²½ë‚¨ìƒê³ -ê²½ì„±ëŒ€-í•œí™”-ë„¥ì„¼	NaN	NaN	korean
  16	ë°±ìŠ¹ë£¡	í•œí™”	NaN	1982ë…„ 08ì›” 16ì¼	NaN	ì‚¬ì§ì´ˆ(ë¶€ì‚°ê·¹ë™ë¦¬í‹€)-ì‚¬ì§ì¤‘-ê²½ë‚¨ìƒê³ -ê²½ì„±ëŒ€-í•œí™”-ë„¥ì„¼	NaN	NaN	korean
  ```

* í‚¤ì™€ ëª¸ë¬´ê²Œ, í¬ì§€ì…˜, ì´ˆë´‰ ë“±ì— ê²°ì¸¡ì¹˜ê°€ ì¡´ì¬

* ì´ ë³€ìˆ˜ë“¤ì˜ ê²°ì¸¡ì¹˜ëŠ” ì¶”ê°€ë¡œ KBOì‚¬ì´íŠ¸ë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ë‚´ë ¤ë°›ê±°ë‚˜ í¬ë¡¤ë§ì„ í†µí•´ ë°ì´í„°ë¥¼ ë³´ì™„í•˜ë©´ í•´ê²°í•  ìˆ˜ ìˆìŒ.

* í•˜ì§€ë§Œ ì´ ë³€ìˆ˜ë“¤ì€ ì¶”í›„ ë¶„ì„ ê³¼ì •ì— ì´ìš©í•˜ì§€ ì•Šì„ ì˜ˆì •ì´ë¯€ë¡œ ê²°ì¸¡ì¹˜ ì²˜ë¦¬ì—ì„œ ë°°ì œí•¨.

* ê²°ì¸¡ì¹˜ ì²˜ë¦¬ì˜ ë§ˆì§€ë§‰ ë‹¨ê³„ë¡œ ì˜ëª»ëœ ê²°ì¸¡ ë°ì´í„°ë¥¼ ì‚­ì œ ë‹¨ê³„

* ì‹¤ì œë¡œ ì•ˆíƒ€ë¥¼ ê¸°ë¡í•œ ì ì´ ìˆìœ¼ë‚˜ ì¥íƒ€ìœ¨ì´ 0ì¸ ê²½ìš°, ì•ˆíƒ€ì™€ ë³¼ë„· ë“±ì„ ê¸°ë¡í•œ ì ì´ ìˆìœ¼ë‚˜ ì¶œë£¨ìœ¨ì´ 0ì¸ ê²½ìš°ê°€ ì¡´ì¬í•¨.

* í•´ë‹¹ ê²½ìš°ëŠ” ëª¨ë‘ 1999ã€œ2000ë…„ì˜ ë°ì´í„°ë¡œ ì‚­ì œ ì²˜ë¦¬ë¥¼ ì§„í–‰

* ì˜ëª»ëœ ê²°ì¸¡ ë°ì´í„°ë¥¼ ì‚­ì œ

  ```python
  # ì‚­ì œí•  ë°ì´í„° ì¶”ì¶œ
  drop_idx = regular_season_df.loc[
      # ì•ˆíƒ€ê°€ 0ê°œ ì´ìƒì´ë©´ì„œ ì¥íƒ€ìœ¨ì´ 0ì¸ ê²½ìš°
      ((regular_season_df['H'] > 0) & (regular_season_df['SLG']==0)) |
          
      # ì•ˆíƒ€ê°€ 0ê°œ ì´ìƒ í˜¹ì€ ë³¼ë„·ì´ 0ê°œ ì´ìƒ í˜¹ì€ ëª¸ì— ë§ì€ ë³¼ì´ 0ê°œ ì´ìƒì´ë©´ì„œ
      # ì¶œë£¨ìœ¨ì´ 0ì¸ ê²½ìš°
      (((regular_season_df['H'] > 0) |
        (regular_season_df['BB'] > 0) |
        (regular_season_df['HBP'] > 0)) &
       (regular_season_df['OBP'] == 0))
  ].index         
  
  # ë°ì´í„° ì‚­ì œ
  regular_season_df = regular_season_df.drop(drop_idx).reset_index(drop=True)
  regular_season_df
  ```

### 3_2 ê·œì • íƒ€ìˆ˜ ì •ì˜

* íƒ€ìˆ˜ê°€ ì‘ì€ ì„ ìˆ˜ëŠ” ì¶œë£¨ìœ¨ì´ë‚˜ ì¥íƒ€ìœ¨ì´ ë§¤ìš° ë†’ê±°ë‚˜ ë‚®ê²Œ í˜•ì„±ë  í™•ë¥ ì´ í¬ê¸° ë•Œë¬¸ì— ì„ ìˆ˜ë“¤ì˜ ì„±ì ì„ ë¶„ì„í•˜ëŠ” ë° ìˆì–´ ê·œì • íƒ€ìˆ˜ë¥¼ ì •ì˜í•˜ëŠ” ê²ƒë„ ì¤‘ìš”í•¨.

* ë¶„ì„ì— í•„ìš” í•œ ê·œì • íƒ€ìˆ˜ë¥¼ ìƒˆë¡­ê²Œ ì •ì˜í•˜ê¸° ìœ„í•´ ì •ê·œì‹œì¦Œ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ íƒ€ìˆ˜ì— ë”°ë¥¸ OPS ìˆ˜ì¹˜ í˜„ í™©ì„ ê·¸ë¦¼ìœ¼ë¡œ í‘œí˜„

* íƒ€ìˆ˜ì— ë”°ë¥¸ OPS ìˆ˜ì¹˜ë¥¼ ì‹œê°í™”

  ```python
  plt.figure(figsize=(6, 3)) # í¬ê¸° ì¡°ì •
  plt.plot('AB', 'OPS', data=regular_season_df, linestyle='none', marker='o', 
           markersize=2, color='blue', alpha=0.4)
  plt.xlabel('AB', fontsize=14)
  plt.ylabel('OPS', fontsize=14)
  plt.xticks(list(range(min(regular_season_df['AB']), max(regular_season_df['AB']), 30)),
             rotation=90)
  plt.vlines(30,ymin=min(regular_season_df['OPS']),ymax=max(regular_season_df['OPS']),
             linestyles='dashed', colors='r')
  plt.show()
  ```

  ![image-20220408124342900](/images/2022-04-08-dacon-2st/image-20220408124342900.png)

* ì‹œê°í™”ë¥¼ í†µí•´ ê·œì • íƒ€ìˆ˜ì— ë”°ë¥¸ OPS ìˆ˜ì¹˜ë¥¼ í™•ì¸í•œ ê²°ê³¼, ê·œì • íƒ€ìˆ˜ê°€ ì ì€ íŠ¹ì •í•œ êµ¬ê°„ì— ì„œ OPSê°€ ë§¤ìš° ë„“ê²Œ ë¶„í¬í•¨ì„ íŒŒì•…í•  ìˆ˜ ìˆìŒ.

* íŠ¹íˆ íƒ€ìˆ˜ê°€ 30 ë¯¸ë§Œì¸ ê²½ìš°ì— ëŒ€í•´ì„œëŠ” OPS ë¶„í¬ê°€ ë§¤ìš° ë„“ìŒ

* ë”°ë¼ì„œ,  30ì„ ê·œì • íƒ€ìˆ˜ë¡œ ì •ì˜í•˜ê³  ë¶„ì„ì„ ì§„í–‰

* ê·œì • íƒ€ìˆ˜ë¥¼ 30ìœ¼ë¡œ ì •ì˜í•˜ëŠ” ê²ƒì˜ íƒ€ë‹¹ì„±ì„ í™•ì¸í•˜ê¸° ìœ„í•´ ì´ì‹±ì¹˜ë¡œ íŒë‹¨ë˜ëŠ” OPSë¥¼ ê¸°ë¡í•œ ê²½ìš°ë¥¼ ë‹¤ì‹œ í•œë²ˆ íƒìƒ‰

* OPS ë°ì´í„°ì˜ ìƒìœ„ 25%, 75% ìˆ˜ì¹˜ì™€ ê·¸ ë²”ìœ„ë¥¼ ì´ìš©í•´ ì´ìƒì¹˜ë¥¼ íƒìƒ‰

* ì´ìƒì¹˜ë¥¼ íƒìƒ‰

  ```python
  # OPS ì´ìƒì¹˜ íƒìƒ‰ì„ ìœ„í•œ ìˆ˜ì¹˜ ì •ì˜
  Q1 = regular_season_df['OPS'].quantile(0.25)
  Q3 = regular_season_df['OPS'].quantile(0.75)
  IQR = Q3 - Q1
  
  # ì‹¤ì œ OPS ì´ìƒì¹˜ íƒìƒ‰
  regular_season_df.loc[(regular_season_df['OPS'] < (Q1 - 1.5 * IQR)) |
                        (regular_season_df['OPS'] > (Q3 + 1.5 * IQR))].sort_values(
      by=['AB'], axis=0, ascending=False)[['batter_name','AB','year','OPS']].head(10)
  
  # ì‹¤í–‰ ê²°ê³¼
  	batter_name	AB	year	OPS
  2329	í…Œì„ì¦ˆ	472	2015	1.293656
  97	ê°•ì •í˜¸	418	2014	1.200156
  1318	ìœ ì¬ì‹ 	33	2018	1.192000
  416	ê¹€ì›ì„­	25	2005	0.116923
  1543	ì´ì—¬ìƒ	22	2013	0.090909
  681	ë¬¸ê·œí˜„	18	2007	0.109000
  578	ê¹€íšŒì„±	17	2010	0.105000
  1902	ì •ë³‘ê³¤	15	2018	0.130000
  1874	ì •ê²½ìš´	15	2018	0.130000
  2384	í˜„ì¬ìœ¤	15	2014	1.229167
  ```

* í™•ì¸ ê²°ê³¼ 2015ë…„ í…Œì„ì¦ˆ, 2014ë…„ ê°•ì •í˜¸ì²˜ëŸ¼ ì„±ì ì´ ë§¤ìš° ë›°ì–´ë‚¬ë˜ íŠ¹ì • ê²½ìš°ë¥¼ ì œì™¸í•œë‹¤ë©´ 30íƒ€ìˆ˜ ì´í•˜ì˜ ì„ ìˆ˜ì—ê²Œì„œ ëŒ€ë¶€ë¶„ ì´ìƒì¹˜ê°€ ë‚˜ì˜´. ì´ë¥¼ í†µí•´ ê·œì • íƒ€ìˆ˜ë¥¼ 30ìœ¼ë¡œ ì •ì˜í•˜ëŠ” ê²ƒì˜ íƒ€ë‹¹ì„±ì„ í™•ì¸ ê°€ëŠ¥

* ìƒë°˜ê¸° ì„±ì ì„ ì •ì˜í•˜ê¸° ìœ„í•´ ë©°ì¹ ê¹Œì§€ì˜ ê¸°ë¡ì„ ìƒë°˜ê¸°ë¡œ ì •ì˜í•  ê²ƒì¸ì§€ ê²°ì •í•´ì•¼ í•¨. 

* ì•¼êµ¬ëŠ” 7ì›” ì¤‘ìˆœì¯¤ì— ì¼ì£¼ì¼ ì •ë„ íœ´ì‹ê¸°ë¥¼ ê°–ìŒ. ì´ íœ´ì‹ ì „ì„ ìƒë°˜ê¸°, ì´ íœ´ì‹ ì´í›„ë¥¼ í•˜ë°˜ê¸°ë¡œ ë´„. ë”°ë¼ì„œ ì´ íœ´ì‹ ê¸°ê°„ì—ëŠ” ì•¼êµ¬ ê²½ê¸° ìˆ˜ê°€ ë‹¤ë¥¸ ë‚ ì§œì— ë¹„í•´ ì ì„ ê²ƒì„.

  ```python
  # 7.01~7.31 ìˆ«ì ìƒì„± í›„ ë°˜ ì˜¬ë¦¼
  major_ticks = list(np.round(np.linspace(7.01,7.31, 31),2)) 
  
  july = (day_by_day_df['date'] >= 7) & (day_by_day_df['date'] < 8) # 7ì›”ë§Œ ë¶ˆëŸ¬ì˜¤ëŠ” index
  plt.plot(major_ticks,
           day_by_day_df['date'].loc[july].value_counts().sort_index(), marker='o')
  plt.xticks(major_ticks,rotation=90)
  plt.show()
  ```

  ![image-20220408124350691](/images/2022-04-08-dacon-2st/image-20220408124350691.png)

* ì´ê²ƒì€ ì¼ë³„ ê·¸ë˜í”„ì—ì„œ 7ì›” í•œ ë‹¬ ë™ì•ˆ ê²½ê¸°ë¥¼ ë›´ ì„ ìˆ˜ë“¤ì˜ ìˆ˜ì˜ í•©ì„ ë‚˜íƒ€ë‚¸ ê·¸ë˜í”„

* ë‹¤ë¥¸ ë‚ ì§œë“¤ì€ 400 ê²½ê¸° ì´ìƒì˜ ê²½ê¸° ìˆ˜ë¥¼ ê¸°ë¡í–ˆëŠ”ë° 7ì›”14ì¼ã€œ7ì›”18ì¼ì€ ë‹¤ë¥¸ ë‚ ì§œì™€ ë‹¬ë¦¬ í™•ì—°í•˜ê²Œ ê²½ê¸° ìˆ˜ê°€ ì ìŒ.

* ì´ ì‹œê¸°ë¥¼ íœ´ì‹ê¸°ë¼ ë³¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ 2019ë…„ì—ë„ 7ì›” 18ì¼ì„ ì „ì²´ ì‹œì¦Œì˜ íœ´ì‹ê¸°ê°„ì´ë¼ê³  ë³´ëŠ” ë° ë¬¸ì œê°€ ì—†ìŒ. 

* ë”°ë¼ì„œ 7ì›”18ì¼ì„ ê¸°ì¤€ìœ¼ë¡œ ìƒë°˜ê¸°ì™€ í•˜ë°˜ê¸°ë¡œ ë‚˜ëˆ”

### 3_3 ì‹œê°„ë³€ìˆ˜

* ì´ ëŒ€íšŒëŠ” ì‹œê¸°ì— ë”°ë¥¸ ì„ ìˆ˜ë“¤ì˜ ì„±ì  ë°ì´í„°ë¥¼ ì œê³µí•˜ê³  ìˆì–´ ì‹œê³„ì—´ íŠ¹ì„±ì„ ì •í™•í•˜ê²Œ íŒŒì•… í•˜ëŠ” ê²ƒì´ ì¤‘ìš”
* ì‹œê°„ ì •ë³´, ì¦‰ ì‹œê³„ì—´ ì •ë³´ë¥¼ ë°˜ì˜í•˜ê¸° ìœ„í•œ ë°©ë²•ì€ ë§ì§€ë§Œ ì´ë²ˆ ëŒ€íšŒì—ì„œëŠ” ì‹œê°„ ë³€ìˆ˜ ìƒì„±ì— ì´ˆì ì„ ë§ì¶° ë¬¸ì œë¥¼ í•´ê²°í•´ë´„

#### ì‹œê°„ ë°˜ì˜ í•¨ìˆ˜ ì •ì˜ì™€ ë³€ìˆ˜ ìƒì„±

* ì‹œê°„ íŠ¹ì„±ì„ ì¢€ ë” ì •í™•íˆ ë°˜ì˜í•˜ê¸° ìœ„í•´ ì„ ìˆ˜ë³„ë¡œ ê³¼ê±° ì„±ì ì„ ë§Œë“¤ì–´ì£¼ëŠ” í•¨ìˆ˜ë¥¼ ì •ì˜

* ê° ì„ ìˆ˜ì˜ 1 ë…„ ì „ ì„±ì , 2ë…„ ì „ ì„±ì , 3ë…„ ì „ ì„±ì , 4ë…„ ì „ ì„±ì  ë“±ìœ¼ë¡œ ë‹¤ìŒ í•´ì˜ ì„±ì ì„ ì˜ˆì¸¡í•˜ëŠ” í˜•ì‹

* ì£¼ì–´ì§„ ë°ì´í„°ì—ì„œëŠ” ê³¼ê±° ì„±ì ì´ ëª¨ë‘ í–‰ ë‹¨ìœ„ë¡œ í©ì–´ì ¸ ìˆìœ¼ë¯€ë¡œ ì´ë¥¼ í†µí•©í•  ë°ì´í„° í”„ë ˆì„ì„ ë§Œë“œëŠ” í•¨ìˆ˜ë¥¼ ì •ì˜

* ê³¼ê±° ì„±ì ì„ í†µí•©í•˜ëŠ” í•¨ìˆ˜

  ```python
  # ì‹œê°„ ë³€ìˆ˜ë¥¼ ìƒì„±í•˜ëŠ” í•¨ìˆ˜ ì •ì˜
  def lag_function(df, var_name, past):
      # df = ì‹œê°„ë³€ìˆ˜ë¥¼ ìƒì„±í•  ë°ì´í„° í”„ë ˆì„
      # var_name = ì‹œê°„ë³€ìˆ˜ ìƒì„±ì˜ ëŒ€ìƒì´ ë˜ëŠ” ë³€ìˆ˜ ì´ë¦„
      # past = ëª‡ ë…„ ì „ì˜ ì„±ì ì„ ìƒì„±í• ì§€ ê²°ì • (ì •ìˆ˜í˜•)
      df.reset_index(drop=True, inplace = True)
      
      #ì‹œê°„ë³€ìˆ˜ ìƒì„±
      df['lag'+str(past)+'_'+var_name] = np.nan;
      df['lag'+str(past)+'_'+'AB'] = np.nan
      
      for col in ['AB', var_name]:
          for i in range(0,(max(df.index)+1)):
              val = df.loc[(df['batter_name'] == df['batter_name'][i]) & 
                           (df['year'] == df['year'][i] - past), col]
              # ê³¼ê±° ê¸°ë¡ì´ ê²°ì¸¡ì¹˜ê°€ ì•„ë‹ˆë¼ë©´ ê°’ì„ ë„£ê¸°
              if(len(val) != 0):
                  df.loc[i, 'lag' + str(past) + '_' + col] = val.iloc[0]
  
      #30íƒ€ìˆ˜ ë¯¸ë§Œ ê²°ì¸¡ì¹˜ ì²˜ë¦¬
      df.loc[df['lag' + str(past) + '_' + 'AB'] < 30, 
             'lag' + str(past) + '_' + var_name] = np.nan
      df.drop('lag' + str(past) + '_' + 'AB', axis = 1, inplace = True)
  
      return df
  ```

#### ë³€ìˆ˜ ì„ íƒ & ì‹œê°„ ë²”ìœ„

* OPSëŠ” On base Plus Sluggingì˜ ì•½ìë¡œ OBP(ì¶œë£¨ìœ¨)ì™€ SLG(ì¥íƒ€ìœ¨)ì˜ í•©ìœ¼ë¡œ ê³„ì‚°
  (QPS= OBP+SLG)

* ë”°ë¼ì„œ ê° ì„ ìˆ˜ì˜ 2019ë…„ë„ OPSë¥¼ ì˜ˆì¸¡í•˜ê¸° ìœ„í•´ OBPì™€ SLGë¥¼ ê°ê° ì˜ˆì¸¡í•œ í›„ ì´ë¥¼ í•©ì³ ëª¨ë¸ë§ì„ ì§„í–‰

* í•˜ì§€ë§Œ ê³¼ê±° ì„±ì ì„ í†µí•´ì„œ ìˆ˜ì¹˜ë¥¼ ì˜ˆì¸¡í•œë‹¤ê³  í• ì§€ë¼ë„ ê³¼ê±°ì˜ ì–´ë–¤ ì„±ì ì„ ì´ìš©í•´ì•¼ í• ì§€, ê³¼ê±°ì˜ ì„±ì ì„ ì–¼ë§ˆë‚˜ ì´ìš©í•´ì•¼ í•˜ëŠ”ì§€ì— ëŒ€í•œ ê²°ì •ì´ í•„ìš”í•¨.

* ì´ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ ìƒê´€ê´€ê³„ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•„ìš”í•œ ë³€ìˆ˜ë¥¼ ì„ íƒí•˜ê³  ê¸°ê°„ì„ ì„¤ì •

* ë³€ìˆ˜ì˜ ìƒê´€ê´€ê³„ë¥¼ ì‹œê°í™”

  ```python
  # ìƒê´€ê´€ê³„ë¥¼ íƒìƒ‰í•  ë³€ìˆ˜ ì„ íƒ
  numerics = ['int16', 'int32', 'int64', 'float16', 'float32', 'float64']
  numeric_cols = list(regular_season_df.select_dtypes(include=numerics).drop(
      ['batter_id','year','OPS','SLG'], axis =1).columns)
  regular_season_temp = regular_season_df[numeric_cols + ['year', 'batter_name']].copy()
  regular_season_temp = regular_season_temp.loc[regular_season_temp['AB'] >= 30]
  
  # ì‹œê°„ë³€ìˆ˜ ìƒì„± í•¨ìˆ˜ë¥¼ í†µí•œ ì§€í‘œë³„ 1ë…„ ì „ ì„±ì  ì¶”ì¶œ
  for col in numeric_cols:
      regular_season_temp = lag_function(regular_season_temp, col, 1)
  
  numeric_cols.remove('OBP')
  regular_season_temp.drop(numeric_cols, axis = 1, inplace= True)
  
  # ìƒê´€ê´€ê³„ ë„ì¶œ
  corr_matrix = regular_season_temp.corr()
  corr_matrix = corr_matrix.sort_values(by = 'OBP', axis = 0, ascending=False)
  corr_matrix = corr_matrix[corr_matrix.index]
  
  # ìƒê´€ê´€ê³„ì˜ ì‹œê°ì  í‘œí˜„
  f, ax = plt.subplots(figsize=(12, 12))
  corr = regular_season_temp.select_dtypes(exclude=["object","bool"]).corr()
  
  # ëŒ€ê° í–‰ë ¬ì„ ê¸°ì¤€ìœ¼ë¡œ í•œ ìª½ë§Œ ë‚˜íƒ€ë‚˜ê²Œ ì„¤ì •í•´ì¤ë‹ˆë‹¤.
  mask = np.zeros_like(corr_matrix, dtype=np.bool)
  mask[np.triu_indices_from(mask)] = True
  
  g = sns.heatmap(corr_matrix, cmap='RdYlGn_r', vmax= 1, mask=mask, 
  center=0, annot=True, fmt='.2f', square=True, linewidths=.5, cbar_kws={"shrink": .5})
  plt.title("Diagonal Correlation HeatMap")
  ```

  ![image-20220408124357311](/images/2022-04-08-dacon-2st/image-20220408124357311.png)

* OBPë¥¼ ê¸°ì¤€ìœ¼ë¡œ í™•ì¸í•´ ë³¸ ê²°ê³¼, íŠ¹ì • ì—°ë„ì˜ OBP(OBP)ì™€ ê³¼ê±°ì˜ OBP(lag1_OBP)ê°€ ë†’ì€ ìƒê´€ì„±ì„ ë ê³  ìˆìŒ.

* BB(ë³¼ë„·)ì™€ ê°™ì´ OBPì™€ ë†’ì€ ìƒê´€ê´€ê³„ë¥¼ ë³´ì—¬ì£¼ëŠ” ì§€í‘œê°€ ë” ì¡´ì¬í•˜ì§€ë§Œ, ì´ë“¤ì€ ëª¨ë‘ 1 ë…„ ì „ì˜ OBPì™€ë„ ë†’ì€ ìƒê´€ê´€ê³„ë¥¼ ë³´ì—¬ì¤Œ.

* ë…ë¦½ë³€ìˆ˜ ê°„ ìƒê´€ ê´€ê³„ê°€ ë†’ì€ ìƒíƒœì—ì„œ ë¶„ì„ì„ ì§„í–‰í•  ê²½ìš° ë‹¤ì¤‘ê³µì„ ì„± ë“±ì˜ ë¬¸ì œê°€ ìƒê¸¸ ìˆ˜ ìˆìœ¼ë¯€ë¡œ BBì™€ ê°™ì€ ë³€ìˆ˜ëŠ” ì‚­ì œí•˜ëŠ” ê²ƒì´ íƒ€ë‹¹í•¨.

* ì¦‰, OBPë¥¼ ì˜ˆì¸¡í•  ë•ŒëŠ” í•´ë‹¹ ì„ ìˆ˜ì˜ ê³¼ê±° OBPë§Œì„ ì´ìš©í•˜ê² ìŠµë‹ˆë‹¤. ì§ê´€ì ìœ¼ë¡œ ìƒê°í•˜ë©´ ì¶œë£¨ìœ¨ì„ ì˜ˆì¸¡í•  ë•ŒëŠ” ê³¼ê±° ì¶œë£¨ìœ¨ì„ ì‚´í´ë´ì•¼ í•¨.

* í•„ìš”í•œ ë³€ìˆ˜ë¥¼ ë°”íƒ•ìœ¼ë¡œ OBP ì˜ˆì¸¡ ëª¨ë¸ì„ ìœ„í•œ ë°ì´í„°ë¥¼ ë¨¼ì € êµ¬ì¶•í•¨.

  * ìš°ì„  ì´ ëŒ€íšŒëŠ” ì„ ìˆ˜ë“¤ì˜ 2019ë…„ë„ ì „ì²´ OPSê°€ ì•„ë‹ˆë¼ ìƒë°˜ê¸°ê¹Œ ì§€ì˜ OPS ì˜ˆì¸¡ì„ ìš”êµ¬í•˜ê¸° ë•Œë¬¸ì— ìƒë°˜ê¸°ì— ì„±ì ì´ ì¢‹ì€ ì„ ìˆ˜ê°€ ìˆì„ ìˆ˜ ìˆê³  í•˜ë°˜ê¸°ì— ì„±ì ì´ ì¢‹ì€ ì„ ìˆ˜ê°€ ìˆì„ ìˆ˜ ìˆìŒì„ ìœ ì¶”í•´ë³¼ ìˆ˜ ìˆìŒ.
  * ì´ë¥¼ ë°˜ì˜í•˜ê¸° ìœ„í•´ ì¼ë°˜ì ìœ¼ë¡œ 7ì›” 18ì¼ê¹Œì§€ KBO ë¦¬ê·¸ì˜ ìƒë°˜ê¸°ê°€ ì§„í–‰ëë˜ ê³¼ê±° ì‚¬ë¡€ë¥¼ í™œìš©
  * ì¦‰, ê³¼ê±° ì„±ì ì„ êµ¬í•  ë•Œ 7ì›” 18ì¼ê¹Œì§€ì˜ ì„±ì ì„ ì´ìš©í•˜ì—¬ ë³€ìˆ˜ë¥¼ ìƒˆë¡­ê²Œ ìƒì„±
  * í•˜ì§€ë§Œ ë‚ ì§œ ì •ë³´ë¥¼ ê°€ì§€ê³  ìˆëŠ” ì¼ë³„ ë°ì´í„°ì—ëŠ” í¬ìƒ í”Œë¼ì´ì— ëŒ€í•œ ì •ë³´ê°€ ì—†ìœ¼ë¯€ë¡œ ì¶”ê°€ë¡œ í‰ê· ì ì¸ í¬ìƒ í”Œë¼ì´ë¥¼ ê³„ì‚°í•œ í›„ì— ê³¼ê±° OBP ì„±ì ì„ ë§Œë“¤ì–´ ì¤Œ.

* í¬ìƒ í”Œë¼ì´ ê³„ì‚°

  ```python
  #í¬ìƒ í”Œë¼ì´ êµ¬í•˜ê¸°
  #OBP(ì¶œë£¨ìœ¨) ê³„ì‚° ê³µì‹ ì´ìš©í•˜ì—¬ SF(í¬ìƒ í”Œë¼ì´)ê³„ì‚° >> (H+BB+HBP)/OBP-(AB+BB+HBP)
  regular_season_df['SF'] = \
      regular_season_df[['H','BB','HBP']].sum(axis=1) / regular_season_df['OBP'] - \
      regular_season_df[['AB','BB','HBP']].sum(axis=1)
  regular_season_df['SF'].fillna(0, inplace = True)
  regular_season_df['SF'] = regular_season_df['SF'].apply(lambda x : round(x,0))
  
  #í•œ íƒ€ìˆ˜ë‹¹ í‰ê·  í¬ìƒ í”Œë¼ì´ ê³„ì‚° í›„ í•„ìš”í•œ ê²ƒë§Œ ì¶”ì¶œ
  regular_season_df['SF_1'] = regular_season_df['SF'] / regular_season_df['AB']
  regular_season_df_SF = regular_season_df[['batter_name','year','SF_1']]
  regular_season_df_SF
  
  # ì‹¤í–‰ ê²°ê³¼
  	batter_name	year	SF_1
  0	ê°€ë¥´ì‹œì•„	2018	0.032787
  1	ê°•ê²½í•™	2011	0.000000
  2	ê°•ê²½í•™	2014	-0.000000
  3	ê°•ê²½í•™	2015	0.009646
  4	ê°•ê²½í•™	2016	0.009901
  ...	...	...	...
  2442	í™©ì§„ìˆ˜	2014	0.000000
  2443	í™©ì§„ìˆ˜	2015	0.000000
  2444	í™©ì§„ìˆ˜	2016	0.000000
  2445	í™©ì§„ìˆ˜	2017	0.008547
  2446	í™©ì§„ìˆ˜	2018	-0.000000
  2447 rows Ã— 3 columns
  ```

* í¬ìƒ í”Œë¼ì´ = (H+BB+HBP)/OBP- (AB+BB+HBP)ë¼ëŠ” ê³µì‹ì„ ì´ìš©í•´ ì§ì ‘ ì„ ìˆ˜ë³„ í¬ìƒ í”Œë¼ì´ë¥¼ ê³„ì‚°

* SF_1 ì´ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ íƒ€ìˆ˜ë‹¹ í‰ê·  í¬ìƒ í”Œë¼ì´ ê³„ì‚° ê²°ê³¼ë¥¼ í™•ì¸ ê°€ëŠ¥

* ì„ ìˆ˜ë³„ ì¶œë£¨ìœ¨

  ```python
  #day_by_dayì—ì„œ ì—°ë„ë³„ ì„ ìˆ˜ì˜ ì‹œì¦Œ ì „ë°˜ê¸° ì¶œë£¨ìœ¨ê³¼ ê´€ë ¨ëœ ì„±ì  í•© êµ¬í•˜ê¸°
  sum_hf_yr_OBP = day_by_day_df.loc[day_by_day_df['date'] <= 7.18].groupby(
      ['batter_name','year'])['AB','H','BB','HBP'].sum().reset_index()
  
  #day_by_dayì™€ regular seasonì—ì„œ êµ¬í•œ í¬ìƒ í”Œë¼ì´ ê´€ë ¨ ë°ì´í„°ë¥¼ í•©ì¹˜ê¸°
  sum_hf_yr_OBP = sum_hf_yr_OBP.merge(regular_season_df_SF, how = 'left',
                                      on=['batter_name','year'])
  
  #ì„ ìˆ˜ë³„ ì „ë°˜ê¸° í¬ìƒ í”Œë¼ì´ ìˆ˜ ê³„ì‚°
  sum_hf_yr_OBP['SF'] = (sum_hf_yr_OBP['SF_1']*sum_hf_yr_OBP['AB']).apply(
      lambda x: round(x, 0))
  sum_hf_yr_OBP.drop('SF_1', axis = 1, inplace = True)
  
  #ì„ ìˆ˜ë³„ ì „ë°˜ê¸° OBP(ì¶œë£¨ìœ¨) ê³„ì‚°
  sum_hf_yr_OBP['OBP'] = sum_hf_yr_OBP[['H', 'BB', 'HBP']].sum(axis = 1) / \
                         sum_hf_yr_OBP[['AB', 'BB', 'HBP','SF']].sum(axis = 1)
  # OBP ê²°ì¸¡ì¹˜ë¥¼ 0ìœ¼ë¡œ ì²˜ë¦¬ 
  sum_hf_yr_OBP['OBP'].fillna(0, inplace = True)
  
  # ë¶„ì„ì— í•„ìš”í•˜ì§€ ì•Šì€ ì—´ ì œê±°
  sum_hf_yr_OBP = sum_hf_yr_OBP[['batter_name','year','AB','OBP']]
  sum_hf_yr_OBP
  
  # ì‹¤í–‰ ê²°ê³¼
  C:\Users\kimminsung\AppData\Roaming\Python\Python36\site-packages\ipykernel_launcher.py:3: FutureWarning: Indexing with multiple keys (implicitly converted to a tuple of keys) will be deprecated, use a list instead.
    This is separate from the ipykernel package so we can avoid doing imports until
  batter_name	year	AB	OBP
  0	ê°€ë¥´ì‹œì•„	2018	85	0.418367
  1	ê°•ê²½í•™	2011	1	0.000000
  2	ê°•ê²½í•™	2014	0	1.000000
  3	ê°•ê²½í•™	2015	156	0.342541
  4	ê°•ê²½í•™	2016	81	0.222222
  ...	...	...	...	...
  1381	í™©ì§„ìˆ˜	2012	4	0.400000
  1382	í™©ì§„ìˆ˜	2013	0	0.000000
  1383	í™©ì§„ìˆ˜	2016	9	0.000000
  1384	í™©ì§„ìˆ˜	2017	71	0.316456
  1385	í™©ì§„ìˆ˜	2018	24	0.230769
  1386 rows Ã— 4 columns
  ```

* í¬ìƒ í”Œë¼ì´ ê³„ì‚°ì„ ì™„ë£Œí–ˆìœ¼ë¯€ë¡œ ì´ì œ ì„ ìˆ˜ë³„ OBP(ì¶œë£¨ìœ¨)ë¥¼ ì •í™•íˆ ê³„ì‚°í•  ìˆ˜ ìˆìŒ.

* êµ¬ì„±í•œ ë…¼ë¦¬ëŒ€ë¡œ 7ì›” 18ì¼ê¹Œì§€ì˜ ì„±ì ì„ ì¶”ë¦° í›„ ê³„ì‚°í•œ í¬ìƒ í”Œë¼ì´ ë°ì´í„°ë¥¼ í•©ì³ ìµœì¢… ìƒë°˜ê¸° ì„ ìˆ˜ë³„ OBPë¥¼ ë„ì¶œ

### 3_4 ì¶”ê°€ ë³€ìˆ˜ ìƒì„±

* ì´ë²ˆ ì˜ˆì¸¡ ëª¨ë¸ë§ì˜ ê¸°ë³¸ ì•„ì´ë””ì–´ëŠ” í•œ ì„ ìˆ˜ì˜ ë¯¸ë˜ OPS(OBP, SLG)ë¥¼ ì˜ˆì¸¡í•˜ëŠ” ë° ìˆì–´ ê³¼ê±° í•´ë‹¹ ì„ ìˆ˜ì˜ OPS(OBP. SLG)ë¥¼ ì´ìš©í•´ ì˜ˆì¸¡ì„ ì§„í–‰

* ì´ ê³¼ì •ì—ì„œ ë‚˜ì´ë¥¼ ë°˜ë“œì‹œ ê³ ë ¤í•´ì•¼ í•¨.

* ì¼ë°˜ì ìœ¼ë¡œ ìš´ë™ì„ ìˆ˜ëŠ” ë‚˜ì´ì— ë”°ë¼ ì˜í•˜ëŠ” ì‹œê¸°ê°€ ì •í•´ì ¸ ìˆëŠ” ê²½ìš°ê°€ ë§ìŒ

* ë˜í•œ ì–´ë¦° ì„ ìˆ˜ì¸ì§€ ê³ ì°¸ ì„ ìˆ˜ì¸ì§€ì— ë”°ë¼ ëª¨ë¸ì´ ê³¼ê±° ì„±ì ë³´ë‹¤ ë‚®ê²Œ ì˜ˆì¸¡ í•´ì•¼ í•˜ëŠ”ì§€ ë†’ê²Œ ì˜ˆì¸¡í•´ì•¼ í•˜ëŠ”ì§€ê°€ ê²°ì •ë  ê²ƒ

* ì´ëŸ¬í•œ ê°€ì„¤ì´ ë§ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ ê°„ë‹¨í•˜ê²Œ ë‚˜ì´ì— ë”°ë¥¸ OBP ì„±ì  ë³€í™” ì¶”ì´ë¥¼ ì‹œê°í™”í•´ íŒŒì•…

* ë‚˜ì´ì— ë”°ë¥¸ ì„±ì  ë³€í™”

  ```python
  # ë‚˜ì´ ë³€ìˆ˜ ìƒì„±
  regular_season_df['age'] = regular_season_df['year'] - \
                             regular_season_df['year_born'].apply(lambda x: int(x[:4]))
  
  # ë‚˜ì´, í‰ê·  ì¶œë£¨ìœ¨, ì¶œë£¨ìœ¨ ì¤‘ìœ„ê°’ìœ¼ë¡œ êµ¬ì„±ëœ ë°ì´í„°í”„ë ˆì„ êµ¬ì¶•
  temp_df = regular_season_df.loc[regular_season_df['AB'] >= 30].groupby('age').agg(
      {'OBP':['mean','median']}).reset_index()
  temp_df.columns = temp_df.columns.droplevel()
  temp_df.columns = ['age', 'mean_OBP', 'median_OBP']
  
  # ë‚˜ì´ì— ë”°ë¥¸ ì¶œë£¨ìœ¨ ì¶”ì´ ì‹œê°í™”
  plt.figure(figsize=(12,8))
  plt.plot('age', 'mean_OBP', data=temp_df, marker='o', markerfacecolor='blue',
           markersize=12, color='skyblue', linewidth=4)
  plt.ylabel('í‰ê· OBP')
  plt.xlabel('ë‚˜ì´')
  plt.show()
  ```

  ![image-20220408124403879](/images/2022-04-08-dacon-2st/image-20220408124403879.png)

* ì‹œê°í™” ê²°ê³¼ë¥¼ ë³´ë‹ˆ í™•ì‹¤íˆ ë‚˜ì´ì— ë”°ë¼ ì¶œë£¨ìœ¨ì˜ ì¶”ì´ê°€ ì¡´ì¬

* ì¶œë£¨ìœ¨ì€ 20ëŒ€ í›„ë°˜ì— ì„œ 30ëŒ€ ì´ˆì¤‘ë°˜ ì‚¬ì´ì—ì„œ ê°€ì¥ ë†’ì€ ìˆ˜ì¹˜ë¥¼ ë³´ì—¬ì¤Œ

* ìš´ë™ì„ ìˆ˜ë¡œì„œì˜ ì „ì„±ê¸°ê°€ 20ëŒ€ í›„ë°˜ ì—ì„œ 30ëŒ€ ì´ˆì¤‘ë°˜ ì‚¬ì´ì—ì„œ í˜•ì„±ëœë‹¤ê³  ë³¼ ìˆ˜ ìˆìŒ

* ë˜í•œ 20ëŒ€ í›„ë°˜ì—ì„œ 30ëŒ€ ì´ˆì¤‘ë°˜ ì‚¬ì´ì˜ êµ¬ê°„ ì´ì „ì—ëŠ” ì¶œë£¨ìœ¨ì´ ìƒìŠ¹í•˜ëŠ” ê²½í–¥ì´ ìˆê³  ì´í›„ êµ¬ê°„ì—ëŠ” ì¶œë£¨ìœ¨ì´ í•˜ë½í•˜ëŠ” ê²½í–¥ì´ ìˆìŒ.

* ë‚˜ì´ì— ë”°ë¼ ëª…í™•í•˜ê²Œ ì „ì„±ê¸° ê°œë…ì´ ì¡´ì¬í•˜ë¯€ë¡œ ì´ë¥¼ ë°˜ì˜í•˜ê¸° ìœ„í•´ ë‚˜ì´ ë³€ìˆ˜ë¥¼ ë°ì´í„°ì— ì¶”ê°€í•˜ê³  ë³€ìˆ˜ ìƒì„±ì„ ì™„ë£Œí•¨.

* ë‚˜ì´ ë³€ìˆ˜ ì¶”ê°€

  ```python
  # ë‚˜ì´ë¥¼ í¬í•¨í•œ ë³€ìˆ˜ ì„ íƒ
  sum_hf_yr_OBP = sum_hf_yr_OBP.merge(regular_season_df[['batter_name','year','age']],
                                      how = 'left', on=['batter_name','year'])
  
  # ì´ 3ë…„ ì „ ì„±ì ê¹Œì§€ ë³€ìˆ˜ë¥¼ ìƒì„±
  sum_hf_yr_OBP = lag_function(sum_hf_yr_OBP, "OBP", 1)
  sum_hf_yr_OBP = lag_function(sum_hf_yr_OBP, "OBP", 2)
  sum_hf_yr_OBP = lag_function(sum_hf_yr_OBP, "OBP", 3)
  sum_hf_yr_OBP
  
  # ì‹¤í–‰ ê²°ê³¼
  	batter_name	year	AB	OBP	age	lag1_OBP	lag2_OBP	lag3_OBP
  0	ê°€ë¥´ì‹œì•„	2018	85	0.418367	33	NaN	NaN	NaN
  1	ê°•ê²½í•™	2011	1	0.000000	19	NaN	NaN	NaN
  2	ê°•ê²½í•™	2014	0	1.000000	22	NaN	NaN	NaN
  3	ê°•ê²½í•™	2015	156	0.342541	23	NaN	NaN	NaN
  4	ê°•ê²½í•™	2016	81	0.222222	24	0.342541	NaN	NaN
  ...	...	...	...	...	...	...	...	...
  1381	í™©ì§„ìˆ˜	2012	4	0.400000	23	NaN	NaN	NaN
  1382	í™©ì§„ìˆ˜	2013	0	0.000000	24	NaN	NaN	NaN
  1383	í™©ì§„ìˆ˜	2016	9	0.000000	27	NaN	NaN	NaN
  1384	í™©ì§„ìˆ˜	2017	71	0.316456	28	NaN	NaN	NaN
  1385	í™©ì§„ìˆ˜	2018	24	0.230769	29	0.316456	NaN	NaN
  1386 rows Ã— 8 columns
  ```

#### 3_5 ë°ì´í„° ì‚¬í›„ ì²˜ë¦¬

* ì§€ê¸ˆê¹Œì§€ ì„¤ëª…í•œ ê³¼ì •ì„ í†µí•´ ë¶„ì„ì— í•„ìš”í•œ ë³€ìˆ˜ë¥¼ ìƒì„±í–ˆë‹¤ë©´, ê·¸ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë°”ë¡œ ëª¨ë¸ ìƒì„±ì— ë“¤ì–´ê°ˆ ìˆ˜ ìˆëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ ê²°ì¸¡ì¹˜ë¥¼ ë‹¤ì‹œ íŒŒì•…

  ```python
  round(sum_hf_yr_OBP[['lag1_OBP','lag2_OBP','lag3_OBP']].isna().sum() / \
        sum_hf_yr_OBP.shape[0], 2)
  # ì‹¤í–‰ ê²°ê³¼
  lag1_OBP    0.41
  lag2_OBP    0.54
  lag3_OBP    0.61
  dtype: float64
  ```

* í™•ì¸ ê²°ê³¼ ê³¼ê±° ì‹œì ì˜ ì¶œë£¨ìœ¨ì— ë§¤ìš° ë§ì€ ê²°ì¸¡ì¹˜ê°€ ì¡´ì¬

* 1ë…„ ì „, 2ë…„ ì „, 3ë…„ ì „ ì„±ì ì— ê°ê° 41%, 54%, 61%ì˜ ê²°ì¸¡ì¹˜ê°€ ì¡´ì¬

* ë³€ìˆ˜ ìƒì„± ì „ ê²°ì¸¡ì¹˜ë¥¼ ì²˜ë¦¬í–ˆìœ¼ë¯€ë¡œ ì´ëŠ” ë³€ìˆ˜ ìƒì„± ê³¼ì •ì—ì„œ ìƒˆë¡œ ìƒê¸´ ê²°ì¸¡ì¹˜ë¼ê³  ë³¼ ìˆ˜ ìˆìŒ.

* ê²°ì¸¡ì¹˜ê°€ ìˆëŠ” ì„ ìˆ˜ê°€ ë§¤ìš° ë§ê³  ë˜ ì „ì²´ ë°ì´í„°ì˜ í¬ê¸°ê°€ ê·¸ë ‡ê²Œ í° í¸ì€ ì•„ë‹ˆë¯€ë¡œ í˜„ì¬ ê²°ì¸¡ì¹˜ë¥¼ ëª¨ë‘ ì‚­ì œí•˜ê±°ë‚˜ 0ìœ¼ ë¡œ ì²˜ë¦¬í•˜ëŠ” ê²ƒì€ íƒ€ë‹¹í•˜ì§€ ì•ŠìŒ

* ë”°ë¼ì„œ ë‹¤ìŒ ë‘ ê°€ì§€ ë°©ì‹ì„ í†µí•´ í•´ê²°

  * ì„ ìˆ˜ë³„ ì¶œë£¨ìœ¨ì˜ í‰ê· ì¹˜ë¥¼ êµ¬í•¨.
  * ì‹œì¦Œë³„ ì¶œë£¨ìœ¨ì˜ í‰ê· ì¹˜ë¥¼ êµ¬í•¨.

* ì´ ë‘ ê°€ì§€ë¥¼ ì¢…í•©í•´ ê³„ì‚°í•œ í‰ê·  ìˆ˜ì¹˜ë¥¼ ê²°ì¸¡ì¹˜ ëŒ€ì‹  ì‚½ì…

* ë˜í•œ ê³„ì‚° ê³¼ì •ì—ì„œ ë„ì¶œ ë˜ëŠ” ì„ ìˆ˜ë³„ ì¶œë£¨ìœ¨ì˜ í‰ê· ì¹˜ëŠ” ê·¸ ìì²´ë¡œ ë‹¤ì‹œ ë°ì´í„°ì— ì ìš©í•´ ì˜ˆì¸¡ ì •í™•ë„ë¥¼ ë†’ì´ëŠ” ë° ì´ìš©

* í‰ê·  ìˆ˜ì¹˜ë¥¼ ê²°ì¸¡ì¹˜ ëŒ€ì‹  ì‚½ì…

  ```python
  #1. ì„ ìˆ˜ë³„ OBP í‰ê· 
  # SF = (H+BB+HBP) / OBP-(AB+BB+HBP)
  # OBP = (H+BB+HBP) / (AB+BB+HBP+SF)
  player_OBP_mean = regular_season_df.loc[regular_season_df['AB'] >= 30].groupby(
      'batter_name')['AB','H','BB','HBP','SF'].sum().reset_index()
  player_OBP_mean['mean_OBP'] = player_OBP_mean[['H', 'BB', 'HBP']].sum(axis=1) / \
                              player_OBP_mean[['AB','BB','HBP','SF']].sum(axis=1)
  
  #2. ì‹œì¦Œë³„ OBP í‰ê· 
  season_OBP_mean = regular_season_df.loc[regular_season_df['AB'] >= 30].groupby(
      'year')['AB','H','BB','HBP','SF'].sum().reset_index()
  season_OBP_mean['mean_OBP'] = season_OBP_mean[['H', 'BB', 'HBP']].sum(axis=1) / \
                                season_OBP_mean[['AB','BB','HBP','SF']].sum(axis=1)
  season_OBP_mean = season_OBP_mean[['year', 'mean_OBP']]
  
  #### player_OBP_mean(ì„ ìˆ˜í‰ê· ) ì—´ ì¶”ê°€
  sum_hf_yr_OBP = sum_hf_yr_OBP.merge(player_OBP_mean[['batter_name', 'mean_OBP']],
                                      how ='left', on="batter_name")
  sum_hf_yr_OBP = \
      sum_hf_yr_OBP.loc[~sum_hf_yr_OBP['mean_OBP'].isna()].reset_index(drop=True)
  sum_hf_yr_OBP
  
  # ì‹¤í–‰ ê²°ê³¼
  batter_name	year	AB	OBP	age	lag1_OBP	lag2_OBP	lag3_OBP	mean_OBP
  0	ê°€ë¥´ì‹œì•„	2018	85	0.418367	33	NaN	NaN	NaN	0.383495
  1	ê°•ê²½í•™	2011	1	0.000000	19	NaN	NaN	NaN	0.337880
  2	ê°•ê²½í•™	2014	0	1.000000	22	NaN	NaN	NaN	0.337880
  3	ê°•ê²½í•™	2015	156	0.342541	23	NaN	NaN	NaN	0.337880
  4	ê°•ê²½í•™	2016	81	0.222222	24	0.342541	NaN	NaN	0.337880
  ...	...	...	...	...	...	...	...	...	...
  1347	í™©ì§„ìˆ˜	2012	4	0.400000	23	NaN	NaN	NaN	0.358779
  1348	í™©ì§„ìˆ˜	2013	0	0.000000	24	NaN	NaN	NaN	0.358779
  1349	í™©ì§„ìˆ˜	2016	9	0.000000	27	NaN	NaN	NaN	0.358779
  1350	í™©ì§„ìˆ˜	2017	71	0.316456	28	NaN	NaN	NaN	0.358779
  1351	í™©ì§„ìˆ˜	2018	24	0.230769	29	0.316456	NaN	NaN	0.358779
  1352 rows Ã— 9 columns
  ```

* ì „ì²´ ì‹œì¦Œì„ í†µí‹€ì–´ êµ¬í•œ í‰ê·  OBPê°€ ê²°ì¸¡ì¹˜ì¸ ì„ ìˆ˜ì˜ ê²½ìš°, í”„ë¡œ ë°ë·” í›„ ë›´ ê²½ê¸°ê°€ ë§¤ìš° ì ê³  1, 2, 3ë…„ ì „ ì„±ì ì´ ë‹¤ ê²°ì¸¡ì¹˜ì„

* ì´ëŸ° ì„ ìˆ˜ë“¤ì€ ì•„ì˜ˆ ë°ì´í„°ì…‹ì—ì„œ ì œê±°

* ì´ì œ ë³¸ê²©ì ìœ¼ë¡œ ì‹œì¦Œì˜ í‰ê·  ì„±ì ê³¼ ì„ ìˆ˜ì˜ í‰ê·  ì„±ì ì˜ í‰ê· ì„ ì´ìš©í•´ ê²°ì¸¡ì¹˜ë¥¼ ì²˜ë¦¬

* ê²°ì¸¡ì¹˜ë¥¼ ì²˜ë¦¬í•˜ëŠ” ê³¼ì •ì„ ë°˜ë³µì ìœ¼ë¡œ ìˆ˜í–‰í•˜ë¯€ë¡œ ê²°ì¸¡ì¹˜ë¥¼ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì •ì˜

* ê²°ì¸¡ì¹˜ ì²˜ë¦¬ í•¨ìˆ˜ ì •ì˜

  ```python
  # ê²°ì¸¡ì¹˜ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜ ì •ì˜
  def lag_na_fill(data_set, var_name, past, season_var_mean_data):
      # data_Set: ì´ìš©í•  ë°ì´í„°ì…‹
      # var_name: ì‹œê°„ ë³€ìˆ˜ë¥¼ ë§Œë“¤ ë³€ìˆ˜ ì´ë¦„
      # past: ëª‡ ë…„ ì „ ë³€ìˆ˜ë¥¼ ë§Œë“¤ì§€ ê²°ì •
      # season_var_name_mean_data seasonë³„ë¡œ var_nameì˜ í‰ê· ì„ êµ¬í•œ ë°ì´í„°
    
      for i in range(0,len(data_set)):
          if np.isnan(data_set["lag"+str(past)+"_"+var_name][i]):
              data_set.loc[i,["lag"+str(past)+"_"+var_name]] = (
                  data_set["mean" + "_" + var_name][i] + season_var_mean_data.loc[
                      season_var_mean_data['year'] == (data_set['year'][i] - past),
                      "mean_" + var_name].iloc[0]
                  ) / 2
      return data_set
  ```

* OBP ê²°ì¸¡ì¹˜ ì²˜ë¦¬

  ```python
  # ìƒì„±í•œ í•¨ìˆ˜ë¥¼ ì´ìš©í•´ ê²°ì¸¡ì¹˜ ì²˜ë¦¬ ì§„í–‰
  sum_hf_yr_OBP = lag_na_fill(sum_hf_yr_OBP, "OBP", 1, season_OBP_mean) # 1ë…„ ì „ ì„±ì  ëŒ€ì²´
  sum_hf_yr_OBP = lag_na_fill(sum_hf_yr_OBP, "OBP", 2, season_OBP_mean) # 2ë…„ ì „ ì„±ì  ëŒ€ì²´
  sum_hf_yr_OBP = lag_na_fill(sum_hf_yr_OBP, "OBP", 3, season_OBP_mean) # 3ë…„ ì „ ì„±ì  ëŒ€ì²´
  sum_hf_yr_OBP
  
  # ì‹¤í–‰ ê²°ê³¼
  	batter_name	year	AB	OBP	age	lag1_OBP	lag2_OBP	lag3_OBP	mean_OBP
  0	ê°€ë¥´ì‹œì•„	2018	85	0.418367	33	0.369982	0.375910	0.373119	0.383495
  1	ê°•ê²½í•™	2011	1	0.000000	19	0.347434	0.348603	0.344259	0.337880
  2	ê°•ê²½í•™	2014	0	1.000000	22	0.346682	0.337511	0.343131	0.337880
  3	ê°•ê²½í•™	2015	156	0.342541	23	0.353425	0.346682	0.337511	0.337880
  4	ê°•ê²½í•™	2016	81	0.222222	24	0.342541	0.353425	0.346682	0.337880
  ...	...	...	...	...	...	...	...	...	...
  1347	í™©ì§„ìˆ˜	2012	4	0.400000	23	0.353580	0.357883	0.359052	0.358779
  1348	í™©ì§„ìˆ˜	2013	0	0.000000	24	0.347960	0.353580	0.357883	0.358779
  1349	í™©ì§„ìˆ˜	2016	9	0.000000	27	0.360760	0.363874	0.357131	0.358779
  1350	í™©ì§„ìˆ˜	2017	71	0.316456	28	0.363552	0.360760	0.363874	0.358779
  1351	í™©ì§„ìˆ˜	2018	24	0.230769	29	0.316456	0.363552	0.360760	0.358779
  1352 rows Ã— 9 columns
  ```

* ì´ì œ ë¶„ì„ì„ ìœ„í•œ ë°ì´í„° ì „ì²˜ë¦¬ë¥¼ ì™„ë£Œ

* ê²°ì¸¡ì¹˜ë¥¼ ì œê±°í•´ ì˜ˆì¸¡ ëª¨ë¸ì´ ë¬´ë¦¬ì—†ì´ ì‘ë™í•˜ê²Œ í•˜ê³  ê·œì • íƒ€ìˆ˜ ì„ ì •, ì‹œê°„ë³€ìˆ˜ ìƒì„± ë“±ìœ¼ë¡œ ì˜ˆì¸¡ ëª¨ë¸ì˜ ì •í™•ë„ë¥¼ ë†’ì„.

### 3_6 SLG ë°ì´í„° ì „ì²˜ë¦¬

* ì§€ê¸ˆê¹Œì§€ OBPì— ëŒ€í•´ ì‹œê°„ ë³€ìˆ˜ ìƒì„±, ì¶”ê°€ ë³€ìˆ˜ ìƒì„±, ë°ì´í„° ì‚¬í›„ ì²˜ë¦¬ ì‘ì—…ì„ ì§„í–‰

* í•˜ì§€ë§Œ, ì—¬ê¸°ì„œ ì˜ˆì¸¡í•´ì•¼ í•˜ëŠ” ê°’ì€ OPSì´ë©°, OPSëŠ” OBP(ì¶œë£¨ìœ¨)ì™€ SLG(ì¥íƒ€ìœ¨)ë¡œ ì´ë£¨ì–´ì§.

* ì§€ê¸ˆë¶€í„°ëŠ” OBPì™€ ê°™ì€ ë…¼ë¦¬ë¡œ SLGì˜ ë°ì´í„° ì „ì²˜ë¦¬ë¥¼ ì§„í–‰

* SLGì™€ ê³¼ê±° ì„±ì  ê°„ì˜ ìƒê´€ê´€ê³„ë¥¼ ê¸°ë°˜ìœ¼ë¡œ SLG ì˜ˆì¸¡ì— í•„ìš”í•œ ë³€ìˆ˜ë¥¼ ì„ íƒ

* SLGì™€ ê³¼ê±° ì„±ì ì˜ ìƒê´€ê´€ê³„

  ```python
  # ìƒê´€ê´€ê³„ë¥¼ íƒìƒ‰í•  ë³€ìˆ˜ ì„ íƒ
  numerics = ['int16', 'int32', 'int64', 'float16', 'float32', 'float64']
  numeric_cols = list(regular_season_df.select_dtypes(include=numerics).drop(
      ['batter_id','year','OPS','OBP'], axis =1).columns)
  regular_season_temp = regular_season_df[numeric_cols + ['year', 'batter_name']].copy()
  regular_season_temp = regular_season_temp.loc[regular_season_temp['AB']>=30]
  
  # ì‹œê°„ë³€ìˆ˜ ìƒì„± í•¨ìˆ˜ë¥¼ í†µí•œ ì§€í‘œë³„ 1ë…„ ì „ ì„±ì  ì¶”ì¶œ
  for col in numeric_cols:
      regular_season_temp = lag_function(regular_season_temp, col, 1)
  
  numeric_cols.remove('SLG')
  regular_season_temp.drop(numeric_cols, axis = 1, inplace=True)
  
  # ìƒê´€ê´€ê³„ ë„ì¶œ
  corr_matrix = regular_season_temp.corr()
  corr_matrix = corr_matrix.sort_values(by = 'SLG', axis = 0, ascending=False)
  corr_matrix = corr_matrix[corr_matrix.index]
  
  # ìƒê´€ê´€ê³„ì˜ ì‹œê°ì  í‘œí˜„
  f, ax = plt.subplots(figsize=(12, 12))
  corr = regular_season_temp.select_dtypes(exclude=["object","bool"]).corr()
  
  # ëŒ€ê° í–‰ë ¬ì„ ê¸°ì¤€ìœ¼ë¡œ í•œìª½ë§Œ ë‚˜íƒ€ë‚˜ê²Œ ì„¤ì •í•´ì¤ë‹ˆë‹¤.
  mask = np.zeros_like(corr_matrix, dtype=np.bool)
  mask[np.triu_indices_from(mask)] = True
  
  cmap = sns.diverging_palette(220, 10, as_cmap=True)
  g = sns.heatmap(corr_matrix, cmap='RdYlGn_r', vmax=1, mask=mask, center=0, annot=True,
                  fmt='.2f', square=True, linewidths=.5, cbar_kws={"shrink": .5})
  plt.title("Diagonal Correlation HeatMap")
  ```

  ![image-20220408124412905](/images/2022-04-08-dacon-2st/image-20220408124412905.png)

* SLGë¥¼ ê¸°ì¤€ìœ¼ë¡œ í™•ì¸í•œ ê²°ê³¼ íŠ¹ì • ì—°ë„ì˜ SLGì™€ 1 ë…„ ì „ ì‹œì ì˜ SLG(lagLSLG)ê°€ ë†’ì€ ìƒê´€ì„±ì„ ë ê³  ìˆìŒ.

* lag1_HR(1ë…„ ì „ í™ˆëŸ° ê°œìˆ˜)ê³¼ ê°™ì´ SLGì™€ ë†’ì€ ìƒê´€ê´€ê³„ë¥¼ ë³´ì—¬ì£¼ëŠ” ì§€í‘œê°€ ë” ì¡´ì¬í•˜ì§€ë§Œ, ì´ë“¤ì€ 1ë…„ ì „ SLGì™€ ë†’ì€ ìƒê´€ê´€ê³„ë¥¼ ë³´ì´ê¸° ë•Œë¬¸ì— OBPì˜ ê²½ìš°ì™€ ë§ˆì°¬ê°€ì§€ë¡œ SLGë¥¼ ì˜ˆì¸¡í•˜ëŠ” ë°ëŠ” í•´ë‹¹ ì„ ìˆ˜ì˜ ê³¼ê±° SLGë§Œ ì´ìš©

* SLG ì—­ì‹œ 2019ë…„ë„ ìƒë°˜ê¸° SLGë¥¼ ì˜ˆì¸¡í•´ì•¼ í•˜ë¯€ë¡œ 7ì›” 18ì¼ê¹Œì§€ì˜ ì„±ì ì„ ì´ìš©í•´ ìƒë°˜ê¸° SLGë¥¼ êµ¬í•¨.

* OBPëŠ” í¬ìƒ í”Œë¼ì´ê°€ ì—†ê¸° ë•Œë¬¸ì— í‰ê· ì ì¸ í¬ìƒ í”Œë¼ì´ë¥¼ ê³„ì‚°í•´ ìƒë°˜ê¸° OBPë¥¼ ê³„ì‚°í–ˆë‹¤ë©´ SLGëŠ” ì£¼ì–´ì§„ ë°ì´í„°ë¡œ ë°”ë¡œ ê³„ì‚°í•  ìˆ˜ ìˆìŒ.

* ìƒë°˜ê¸° SLG

  ```python
  # day_by_dayì—ì„œ ì—°ë„ë³„ ì„ ìˆ˜ì˜ ì‹œì¦Œ ì „ë°˜ê¸° ì¥íƒ€ìœ¨(SLG)ê³¼ ê´€ë ¨ëœ ì„±ì  í•© êµ¬í•˜ê¸°
  sum_hf_yr_SLG = day_by_day_df.loc[day_by_day_df['date'] <= 7.18].groupby(
      ['batter_name','year'])['AB','H','2B','3B', 'HR'].sum().reset_index()
  
  # ì „ë°˜ê¸° ì¥íƒ€ìœ¨ ê³„ì‚°
  sum_hf_yr_SLG['SLG'] = \
      (sum_hf_yr_SLG['H'] - sum_hf_yr_SLG[['2B', '3B', 'HR']].sum(axis=1) +
       sum_hf_yr_SLG['2B']*2 + sum_hf_yr_SLG['3B']*3 + sum_hf_yr_SLG['HR']*4
       ) / sum_hf_yr_SLG['AB']
  
  # SLG ê²°ì¸¡ì¹˜ë¥¼ 0ìœ¼ë¡œ ì²˜ë¦¬ 
  sum_hf_yr_SLG['SLG'].fillna(0, inplace=True)
  
  # í•„ìš”í•œ ì¹¼ëŸ¼ë§Œ ë¶ˆëŸ¬ì˜¤ê³  ë‚˜ì´ ê³„ì‚°
  sum_hf_yr_SLG = sum_hf_yr_SLG[['batter_name','year','AB','SLG']]
  sum_hf_yr_SLG = sum_hf_yr_SLG.merge(regular_season_df[['batter_name','year','age']],
                                      how='left', on=['batter_name','year'])
  sum_hf_yr_SLG.head()
  
  # ì‹¤í–‰ ê²°ê³¼
  	batter_name	year	AB	SLG	age
  0	ê°€ë¥´ì‹œì•„	2018	85	0.552941	33
  1	ê°•ê²½í•™	2011	1	0.000000	19
  2	ê°•ê²½í•™	2014	0	0.000000	22
  3	ê°•ê²½í•™	2015	156	0.333333	23
  4	ê°•ê²½í•™	2016	81	0.222222	24
  ```

* OBPì—ì„œ ë°œê²¬í–ˆë˜ ë¬¸ì œì™€ ê°™ì´ SLGì—ì„œë„ 1, 2, 3ë…„ ì „ ì„±ì ì„ ë§Œë“¤ì–´ì¤€ í›„ ê²°ì¸¡ì¹˜ê°€ ìƒˆë¡­ê²Œ ìƒê¸°ëŠ”ì§€ í™•ì¸í•´ë´„.

* 3ë…„ ì „ ì„±ì ê¹Œì§€ ë³€ìˆ˜ë¥¼ ìƒì„±

  ```python
  # ì´ 3ë…„ ì „ ì„±ì ê¹Œì§€ ë³€ìˆ˜ë¥¼ ìƒì„±
  sum_hf_yr_SLG = lag_function(sum_hf_yr_SLG, "SLG", 1)
  sum_hf_yr_SLG = lag_function(sum_hf_yr_SLG, "SLG", 2)
  sum_hf_yr_SLG = lag_function(sum_hf_yr_SLG, "SLG", 3)
  display(sum_hf_yr_SLG.head())
  
  round(sum_hf_yr_SLG[['lag1_SLG', 'lag2_SLG', 'lag3_SLG']].isna().sum()/\
        sum_hf_yr_SLG.shape[0], 2)
  
  # ì‹¤í–‰ ê²°ê³¼
  
  batter_name	year	AB	SLG	age	lag1_SLG	lag2_SLG	lag3_SLG
  0	ê°€ë¥´ì‹œì•„	2018	85	0.552941	33	NaN	NaN	NaN
  1	ê°•ê²½í•™	2011	1	0.000000	19	NaN	NaN	NaN
  2	ê°•ê²½í•™	2014	0	0.000000	22	NaN	NaN	NaN
  3	ê°•ê²½í•™	2015	156	0.333333	23	NaN	NaN	NaN
  4	ê°•ê²½í•™	2016	81	0.222222	24	0.333333	NaN	NaN
  lag1_SLG    0.41
  lag2_SLG    0.54
  lag3_SLG    0.61
  dtype: float64
  ```

* OBPì—ì„œ ê²°ì¸¡ì¹˜ë¥¼ ì²˜ë¦¬í•  ë•Œ ì„ ìˆ˜ í‰ê·  ì„±ì ì„ ìƒˆë¡œìš´ ë³€ìˆ˜ë¡œ ìƒì„±

* ì´í›„ `lag_na_ fill` í•¨ìˆ˜ì™€ ì‹œì¦Œ ì„±ì , ì„ ìˆ˜ì˜ í‰ê·  ì„±ì ì„ ì´ìš©í•´ ê³¼ê±° ì„±ì ì˜ ê²°ì¸¡ì¹˜ë¥¼ ì²˜ë¦¬í–ˆë˜ ê²ƒì²˜ëŸ¼ SLGì—ì„œë„ ë™ì¼í•œ ê³¼ì •ì„ ì ìš©

* ê³¼ê±° SLGì˜ ê²°ì¸¡ì¹˜ ì²˜ë¦¬

  ```python
  # ì„ ìˆ˜ë³„ SLG í‰ê·  ë°ì´í„°(player_SLG_mean)ë¥¼ ë§Œë“­ë‹ˆë‹¤
  player_SLG_mean = regular_season_df.loc[regular_season_df['AB'] >= 30].groupby(
      'batter_name')['AB','H','2B','3B','HR'].sum().reset_index()
  player_SLG_mean['mean_SLG'] = \
      (player_SLG_mean['H'] - player_SLG_mean[['2B','3B','HR']].sum(axis = 1) +
       player_SLG_mean['2B']*2 + player_SLG_mean['3B']*3 + player_SLG_mean['HR']*4
      ) / player_SLG_mean['AB']
  
  # ì‹œì¦Œë³„ SLG í‰ê·  ë°ì´í„°(season_SLG_mean)ë¥¼ ë§Œë“­ë‹ˆë‹¤
  season_SLG_mean = regular_season_df.loc[regular_season_df['AB'] >= 30].groupby(
      'year')['AB','H','2B','3B','HR'].sum().reset_index()
  season_SLG_mean['mean_SLG'] = \
      (season_SLG_mean['H'] - season_SLG_mean[['2B','3B','HR']].sum(axis = 1) + 
       season_SLG_mean['2B']*2 + season_SLG_mean['3B']*3 + season_SLG_mean['HR']*4
      ) / season_SLG_mean['AB']
  
  # ì„ ìˆ˜ í‰ê· ì˜ SLG(player_OBP_mean)ë¥¼ ìƒˆë¡œìš´ ë³€ìˆ˜ë¡œ ë”í•©ë‹ˆë‹¤.
  sum_hf_yr_SLG = sum_hf_yr_SLG.merge(player_SLG_mean[['batter_name', 'mean_SLG']],
                                      how='left', on="batter_name")
  
  # ì„ ìˆ˜ í‰ê· ì˜ ì„±ì ì´ ê²°ì¸¡ì¹˜ì´ë©´ ë°ì´í„°ì—ì„œ ì œê±°í•©ë‹ˆë‹¤.
  sum_hf_yr_SLG = \
      sum_hf_yr_SLG.loc[~sum_hf_yr_SLG['mean_SLG'].isna()].reset_index(drop=True)
  
  # ê²°ì¸¡ì¹˜ ì²˜ë¦¬
  sum_hf_yr_SLG = lag_na_fill(sum_hf_yr_SLG, "SLG", 1, season_SLG_mean) #1ë…„ì „ ì„±ì  ëŒ€ì²´
  sum_hf_yr_SLG = lag_na_fill(sum_hf_yr_SLG, "SLG", 2, season_SLG_mean) #2ë…„ì „ ì„±ì  ëŒ€ì²´
  sum_hf_yr_SLG = lag_na_fill(sum_hf_yr_SLG, "SLG", 3, season_SLG_mean) #3ë…„ì „ ì„±ì  ëŒ€ì²´
  
  display(sum_hf_yr_SLG.head())
  round(sum_hf_yr_SLG[['lag1_SLG', 'lag2_SLG', 'lag3_SLG']].isna().sum()/\
        sum_hf_yr_SLG.shape[0], 2)
  
  # ì‹¤í–‰ ê²°ê³¼
  	batter_name	year	AB	SLG	age	lag1_SLG	lag2_SLG	lag3_SLG	mean_SLG
  0	ê°€ë¥´ì‹œì•„	2018	85	0.552941	33	0.481855	0.481498	0.476627	0.519126
  1	ê°•ê²½í•™	2011	1	0.000000	19	0.372902	0.380882	0.361716	0.332527
  2	ê°•ê²½í•™	2014	0	0.000000	22	0.362931	0.349344	0.359616	0.332527
  3	ê°•ê²½í•™	2015	156	0.333333	23	0.389415	0.362931	0.349344	0.332527
  4	ê°•ê²½í•™	2016	81	0.222222	24	0.333333	0.389415	0.362931	0.332527
  lag1_SLG    0.0
  lag2_SLG    0.0
  lag3_SLG    0.0
  dtype: float64
  ```

* í™•ì¸ ê²°ê³¼ ë°ì´í„°ì— ê²°ì¸¡ì¹˜ê°€ ë”ëŠ” ì¡´ì¬í•˜ì§€ ì•ŠìŒ

* ì´ì œ ë³€ìˆ˜ ìƒì„±, ê²°ì¸¡ì¹˜ ì²˜ë¦¬ê¹Œì§€ í•„ ìš”í•œ ë°ì´í„° ì „ì²˜ë¦¬ë¥¼ ëª¨ë‘ ì™„ë£Œ

* ì´ëŠ” ë¨¸ì‹ ëŸ¬ë‹ì„ ì´ìš©í•´ KBO íƒ€ìì˜ 2019 ìƒë°˜ ê¸° ì‹œì¦Œ ì„±ì  ì˜ˆì¸¡ì„ ìœ„í•œ ëª¨ë¸ë§ ì‘ì—…ì„ í•˜ê¸° ì „ì— í•„ìš”í•œ ì¤€ë¹„ê°€ ëª¨ë‘ ì™„ë£ŒëìŒì„ ì˜ë¯¸

* ì´í›„ ê³¼ì •ì—ì„œëŠ” ì „ì²˜ë¦¬í•œ ë°ì´í„°ë¥¼ í†µí•´ KBO íƒ€ìì˜ ë‹¤ìŒ ì‹œì¦Œ OPSë¥¼ ì˜ˆì¸¡í•˜ê¸° ìœ„í•œ í•™ìŠµì„ ì§„í–‰

## 4_ ëª¨ë¸ êµ¬ì¶•ê³¼ ê²€ì¦[ğŸ“‘](#contents)<a id='4'></a>

* ì§€ê¸ˆê¹Œì§€ ì´ë²ˆ ëŒ€íšŒì˜ ê°œìš”ë¥¼ ì´í•´í•˜ê³ , íƒìƒ‰ì  ë°ì´í„° ë¶„ì„ ë° ë°ì´í„° ì „ì²˜ë¦¬ ê³¼ì •ì„ ë§ˆì¹¨
* ì´ ëª¨ë“  ê³¼ì •ì€ ëª¨ë¸ë§ì„ ìœ„í•œ ì„ í–‰ ê³¼ì •ì´ë¼ê³  ë³¼ ìˆ˜ ìˆìŒ.
* ì—¬ê¸°ì„œ ëª¨ë¸ë§ì€ <2019 ì‹œì¦Œ ìƒë°˜ê¸° KBO íƒ€ìì˜ OPS ì„±ì ì„ ì˜ˆì¸¡í•˜ê¸° ìœ„í•œ ë¨¸ì‹ ëŸ¬ë‹ ì•Œê³ ë¦¬ì¦˜ ìƒì„± ê³¼ì •>ì„ í†µì¹­ í•˜ëŠ” ìš©ì–´
* ì´ ì ˆì—ì„œëŠ” í•™ìŠµì„ ìœ„í•´ ì¤€ë¹„í•œ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ëª¨ë¸ë§ ì§ì—…ì„ ì§„í–‰
* ê°„ë‹¨í•œ ì„ í˜• ëª¨ë¸ì¸ ë¦¿ì§€(Ridge) ë° ë¼ì˜(Lasso) íšŒê·€ ëª¨ë¸, íŠ¸ë¦¬ ê¸°ë°˜ ëª¨ë¸ì˜ ëœë¤ í¬ë ˆìŠ¤íŠ¸, ìµœê·¼ ë¨¸ì‹ ëŸ¬ë‹ ë¶„ì•¼ì—ì„œ ê°ê´‘ë°›ëŠ” ë¶€ìŠ¤íŒ… ëª¨ë¸ì„ ê°ê° êµ¬ì¶•í•˜ê³  ê·¸ ì„±ëŠ¥ì„ ë¹„êµí•´ë´„.

### 4_1 ë°ì´í„° ë¶„í• 

* ìš°ì„  ë°ì´í„° ì „ì²˜ë¦¬ ë‹¨ê³„ì—ì„œ ì •ì˜í•œ ê·œì • íƒ€ìˆ˜ì¸ 30íƒ€ìˆ˜ ì´ìƒì˜ ì„ ìˆ˜ë“¤ë§Œ ì¶”ì¶œ

* ì´í›„ í•™ìŠµì— ì´ìš©í•  í•™ìŠµìš© ë°ì´í„°ì…‹, í•™ìŠµ ê²°ê³¼ë¥¼ í‰ê°€í•˜ëŠ” í…ŒìŠ¤íŠ¸ìš© ë°ì´í„°ì…‹ìœ¼ë¡œ ë°ì´í„° ë¥¼ ë¶„í• 

* ì´ ëŒ€íšŒëŠ” ê³¼ê±° ì„±ì ì˜ ì¶”ì„¸ë¡œ ë¯¸ë˜ ì„±ì ì„ ì˜ˆì¸¡í•´ì•¼ í•˜ëŠ”ë°, ì´ë¥¼ ì‹œê³„ì—´ íŠ¹ì„±ì´ ë°˜ì˜ë¼ ìˆë‹¤ê³  ë§í•©ë‹ˆë‹¤. 

* ì´ ë•Œë¬¸ì— ëŒ€íšŒ ì‹œì ì¸ 2019ë…„ ê¸°ì¤€ìœ¼ë¡œ ê°€ì¥ ê°€ê¹Œìš´ ê³¼ê±°ì¸ 2018ë…„ì˜ ë°ì´í„°ë¥¼ í…ŒìŠ¤íŠ¸ ë°ì´í„°ì…‹ìœ¼ë¡œ ì„¤ì •í•˜ê³  2018ë…„ ì´ì „ì˜ ë°ì´í„°ë¥¼ í•™ìŠµ ë°ì´í„°ì…‹ìœ¼ë¡œ ì„¤ì •

* ë°ì´í„° ë¶„í• 

  ```python
  # 30íƒ€ìˆ˜ ì´ìƒì˜ ë°ì´í„°ë§Œ í•™ìŠµ
  sum_hf_yr_OBP= sum_hf_yr_OBP.loc[sum_hf_yr_OBP['AB']>=30]
  sum_hf_yr_SLG = sum_hf_yr_SLG.loc[sum_hf_yr_SLG['AB']>=30] 
  
  # 2018ë…„ ë°ì´í„°ë¥¼ test ë°ì´í„° 2018ë…„ ì´ì „ì€ train ë°ì´í„°ë¡œ ë‚˜ëˆˆë‹¤.
  OBP_train = sum_hf_yr_OBP.loc[sum_hf_yr_OBP['year'] != 2018]
  OBP_test = sum_hf_yr_OBP.loc[sum_hf_yr_OBP['year'] == 2018]
  
  SLG_train = sum_hf_yr_SLG.loc[sum_hf_yr_SLG['year'] != 2018]
  SLG_test = sum_hf_yr_SLG.loc[sum_hf_yr_SLG['year'] == 2018]
  print(OBP_train.shape, OBP_test.shape, SLG_train.shape, SLG_test.shape)
  
  # ì‹¤í•¼ ê²°ê³¼
  (872, 9) (150, 9) (872, 9) (150, 9)
  ```

* í™•ì¸ ê²°ê³¼ í…ŒìŠ¤íŠ¸ìš© ë°ì´í„°ë¡œ ì´ìš©ë  2018ë…„ì˜ ë°ì´í„°ëŠ” 150ê°œ, í•™ìŠµìš© ë°ì´í„°ë¡œ ì´ìš©ë  2018ë…„ ì´ì „ì˜ ë°ì´í„°ëŠ”872ê°œ ì¡´ì¬

* ë°ì´í„°ë¥¼ í•™ìŠµìš©ê³¼ í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ ë¶„í• í–ˆìœ¼ë¯€ë¡œ ì´ì œ í‰ê°€ì§€í‘œë¥¼ ìƒì„±

* í‰ê°€ì§€í‘œë¥¼ ì´ìš©í•´ í…ŒìŠ¤íŠ¸ìš© ë°ì´í„°ì…‹ì—ì„œ ìš°ìˆ˜í•œ ëª¨ë¸ì„ ì°¾ì•„ì•¼ í•¨

* ëŒ€íšŒì˜ í‰ê°€ì§€í‘œì— ë§ê²Œ í‰ê°€í•˜ê¸° ìœ„í•´ ìƒˆë¡­ê²Œ í•¨ìˆ˜ë¥¼ ë§Œë“¦

* WRMSE ì •ì˜

  ```python
  def wrmse(v,w,p):
      # v: ì‹¤ì œê°’
      # w: íƒ€ìˆ˜
      # p: ì˜ˆì¸¡ê°’
      return sum(np.sqrt(((v-p)**2 * w) / sum(w)))
  ```

* ëŒ€íšŒì˜ í‰ê°€ì§€í‘œì¸ WRMSEì— ë§ì¶° ìƒˆë¡­ê²Œ í•¨ìˆ˜ë¥¼ ì •ì˜

* ì´ì œ ì´ í•¨ìˆ˜ë¥¼ í†µí•´ ì•ìœ¼ ë¡œ ì§„í–‰í•  ëª¨ë¸ë§ì´ ì–¼ë§ˆë‚˜ ì˜ ì ìš©ë˜ëŠ”ì§€ë¥¼ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤, ëª¨ë¸ ì„ íƒ, í•˜ì´í¼íŒŒë¼ë¯¸í„° íŠœë‹ ë“± ì´í›„ ì§„í–‰í•  ê³¼ì •ì—ì„œ ì´ í•¨ìˆ˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìµœì ì˜ ëª¨ë¸ì„ ì„ íƒ

### 4_2 ëª¨ë¸ ì„ íƒ

* ë°ì´í„° ë¶„í• ê¹Œì§€ ì™„ë£Œí–ˆìœ¼ë¯€ë¡œ ì´ì œ ë³¸ê²©ì ì¸ í•™ìŠµ ê³¼ì •ì„ ì§„í–‰
* í•™ìŠµì„ ìœ„í•´ ë‹¤ì–‘í•œ ëª¨ë¸ì„ ì´ìš©í•  ê²ƒì´ë©° ê° ëª¨ë¸ì˜ ì„±ëŠ¥ì„ ë¹„êµí•´ ê°€ì¥ ì¢‹ì€ ì„±ëŠ¥ì„ ë³´ì¸ ëª¨ë¸ì„ ìµœì¢… ì„ íƒí•˜ëŠ” ë°©ë²•ì„ ì´ìš©
* ì—¬ê¸°ì„œëŠ” ë„¤ ê°€ì§€ ëª¨ë¸ì˜ ì„±ëŠ¥ì„ ë¹„êµí•˜ê² ìŠµë‹ˆë‹¤.
  * ë¦¿ì§€ íšŒê·€ ëª¨ë¸
  * ë¼ì˜ íšŒê·€ ëª¨ë¸
  * ëœë¤ í¬ë ˆìŠ¤íŠ¸
  * XGBoos
* ì„ íƒ ì‹¤ìŠµ ì½”ë“œëŠ” ë¦¿ì§€ íšŒê·€ ëª¨ë¸ ëœë¤ í¬ë ˆìŠ¤íŠ¸ ë“± ê° ì•Œê³ ë¦¬ì¦˜ì˜ ìµœì  ëª¨ìˆ˜ë¥¼ ì°¾ëŠ” ê³¼ì •ì„ í¬í•¨í•˜ë¯€ë¡œ ì½”ë“œ ì‹¤í–‰ ì‹œê°„ì´ ê¸¸ì–´ì§ˆ ìˆ˜ ìˆìŒ.

#### ë¦¿ì§€ì™€ ë¼ì˜

* ë¦¿ì§€ íšŒê·€ ëª¨ë¸ê³¼ ë¼ì˜ íšŒê·€ ëª¨ë¸ì€ ëª¨ë‘ ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ì„ í˜•íšŒê·€ ëª¨ë¸ì„ ë³€í˜•ì‹œí‚¨ ì•Œê³ ë¦¬ì¦˜

* ì„ í˜•íšŒê·€ ëª¨ë¸ í•™ìŠµì— ì¶”ê°€ë¡œ ì ì ˆí•œ í˜ë„í‹°ë¥¼ ë¶€ì—¬í•´ ë” ì¼ë°˜í™”ëœ ëª¨ë¸ì„ ë§Œë“¤ì–´ ë‚´ëŠ” ê²ƒì´ ëª©ì 

* ì„ í˜•íšŒê·€ ëª¨ë¸ì€ ìµœì‹  ì•Œê³ ë¦¬ì¦˜ë³´ë‹¤ ì„±ëŠ¥ì´ ë–¨ì–´ì§€ì§€ë§Œ, í•´ì„í•˜ê¸° ì‰½ë‹¤ëŠ” ì¥ì ì´ ìˆìŒ

* ê·¸ë¦¬ê³  ë°ì´í„°ê°€ ì ì„ ë•Œ ìƒëŒ€ì ìœ¼ë¡œ ê°•ì ì„ ë³´ì´ëŠ” ëª¨ë¸ì´ê¸°ë„ í•¨.

* ì´ë²ˆ ë¶„ì„ì—ì„œëŠ” ë¦¿ì§€ì™€ ë¼ì˜ íšŒê·€ ëª¨ë¸ ëª¨ë‘ ì£¼ì–´ì§„ ë²”ìœ„ ë‚´ì—ì„œ ëª¨ë“  ê²½ìš°ì˜ ìˆ˜ë¥¼ ë¹„êµí•´ ìµœì ì˜ ëª¨ìˆ˜ë¥¼ ê²°ì • í•˜ëŠ” ë°©ë²•ì¸ ê·¸ë¦¬ë“œ íƒìƒ‰(grid search) ë°©ë²•ì„ ì´ìš©í•´ ëª¨ë¸ë§ì„ ì§„í–‰

* ë¦¿ì§€ì™€ ë¼ì˜ íšŒê·€ ëª¨ë¸

  ```python
  from sklearn.linear_model import Ridge, Lasso
  from sklearn.model_selection import GridSearchCV
  
  # log ë‹¨ìœ„(1e+01)ë¡œ 1.e-04 ~ 1.e+01 ì‚¬ì´ì˜ êµ¬ê°„ì— ëŒ€í•´ parameterë¥¼ íƒìƒ‰í•œë‹¤. 
  lasso_params = {'alpha':np.logspace(-4, 1, 6)} 
  ridge_params = {'alpha':np.logspace(-4, 1, 6)} 
  
  # GridSearchCVë¥¼ ì´ìš©í•˜ì—¬ dictì— Lasso, Ridege OBP ëª¨ë¸ì„ ì €ì¥í•œë‹¤.
  OBP_linear_models = {
      'Lasso': GridSearchCV(Lasso(), param_grid=lasso_params).fit(
          OBP_train.iloc[:,-5:], OBP_train['OBP']).best_estimator_,
      'Ridge': GridSearchCV(Ridge(), param_grid=ridge_params).fit(
          OBP_train.iloc[:,-5:], OBP_train['OBP']).best_estimator_,}
  
  # GridSearchCVë¥¼ ì´ìš©í•˜ì—¬ dictì— Lasso, Ridge SLG ëª¨ë¸ì„ ì €ì¥í•œë‹¤
  SLG_linear_models = {
      'Lasso': GridSearchCV(Lasso(), param_grid=lasso_params).fit(
          SLG_train.iloc[:,-5:], SLG_train['SLG']).best_estimator_,
      'Ridge': GridSearchCV(Ridge(),param_grid=ridge_params).fit(
          SLG_train.iloc[:,-5:], SLG_train['SLG']).best_estimator_,}
  ```

#### ëœë¤ í¬ë ˆìŠ¤íŠ¸

* ëœë¤ í¬ë ˆìŠ¤íŠ¸ëŠ” íŠ¸ë¦¬ ê¸°ë°˜ ëª¨ë¸ë¡œ ë³´í¸ì ìœ¼ë¡œ ì“°ì´ëŠ” ì•Œê³ ë¦¬ì¦˜

* ëœë¤ í¬ë ˆìŠ¤íŠ¸ ì—­ì‹œ ë¦¿ì§€ì™€ ë¼ì˜ íšŒê·€ ë¶„ì„ ëª¨ë¸ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ê·¸ë¦¬ë“œ íƒìƒ‰ì„ í†µí•´ ìµœì ì˜ ëª¨ìˆ˜ë¥¼ ì°¾ì•„ ëª¨ë¸ì„ í˜•ì„±

* i5-8250U CPU, ë©”ëª¨ë¦¬ 12GB í™˜ê²½ì—ì„œ ì•½ 559ì´ˆ ì†Œìš”ë¨.

* ì‹¤í–‰í™˜ê²½ ì— ë”°ë¼ ì•„ë˜ ì½”ë“œ ì‹¤í–‰ì— ê±¸ë¦¬ëŠ” ì‹œê°„ì€ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŒ

* ëœë¤ í¬ë ˆìŠ¤íŠ¸

  ```python
  import time
  from sklearn.ensemble import RandomForestRegressor 
  start = time.time() # ì‹œì‘ ì‹œê°„ ì €ì¥
  
  # ëœë¤ í¬ë ˆìŠ¤íŠ¸ì˜ parameter ë²”ìœ„ë¥¼ ì •ì˜í•œë‹¤.
  RF_params = {
      'n_estimators': [50,100,150,200,300,500,1000],
      'max_features': ['auto', 'sqrt'],
      'max_depth' : [1,2,3,5,6,10],
      'min_samples_leaf': [1, 2, 4],
      'min_samples_split': [2, 3, 5, 10]}
  
  # GridSearchCVë¥¼ ì´ìš©í•˜ì—¬ dictì— OBP Randomforest ëª¨ë¸ì„ ì €ì¥í•œë‹¤.
  OBP_RF_models = {
      'RF': GridSearchCV(
          RandomForestRegressor(random_state=42), param_grid=RF_params, n_jobs=-1
          ).fit(OBP_train.iloc[:,-5:], OBP_train['OBP']).best_estimator_}
  
  # GridSearchCVë¥¼ ì´ìš©í•˜ì—¬ dictì— OBP Randomforest ëª¨ë¸ì„ ì €ì¥í•œë‹¤.
  SLG_RF_models = {
      'RF': GridSearchCV(
          RandomForestRegressor(random_state=42), param_grid=RF_params, n_jobs=-1
          ).fit(SLG_train.iloc[:,-5:], SLG_train['SLG']).best_estimator_}
  
  print(f"ê±¸ë¦°ì‹œê°„ : {np.round(time.time() - start,3)}ì´ˆ") # í˜„ì¬ì‹œê°„ â€“ ì‹œì‘ì‹œê°„(ë‹¨ìœ„ ì´ˆ)
  
  # ì‹¤í–‰ ê²°ê³¼
  ê±¸ë¦°ì‹œê°„ : 180.643ì´ˆ
  ```

#### XGBoost(eXtra Gradient Boost)

* XGBoostëŠ” ëœë¤ í¬ë ˆìŠ¤íŠ¸ì™€ ë§ˆì°¬ê°€ì§€ë¡œ íŠ¸ë¦¬ ê¸°ë°˜ ëª¨ë¸

* íŠ¹íˆ í•™ìŠµì„ ì§„í–‰í•  ë•Œ ì˜¤ë¶„ë¥˜ëœ ë°ì´í„°ì— ê°€ì¤‘ì¹˜ë¥¼ ë¶€ì—¬í•´ ì„±ëŠ¥ì„ ë†’ì´ê³ ì í•˜ëŠ” ëª¨ë¸

* ë§ˆì°¬ê°€ì§€ë¡œ ê·¸ë¦¬ë“œ íƒìƒ‰ ë°©ì‹ì„ ì´ìš©í•´ XGBoost ëª¨ë¸ì„ ìƒì„±

* Mac ê¸°ë°˜ì˜ OSë¥¼ ì´ìš©í•˜ëŠ” ê²½ìš° brew install libomp ëª…ë ¹ ë“±ì„ ì‹¤í–‰í•´ OpenMP ë¼ì´ë¸Œ ëŸ¬ë¦¬ë¥¼ ì‚¬ì „ì— ì„¤ì¹˜í•´ë‘ì–´ì•¼ í•¨.

* XGBoost

  ```python
  import xgboost as xgb 
  start = time.time() # ì‹œì‘ ì‹œê°„ ì €ì¥
  
  # xgboost parmeter spaceë¥¼ ì •ì˜í•œë‹¤.
  XGB_params = {
      'min_child_weight': [1,3, 5,10],
      'gamma': [0.3,0.5, 1, 1.5, 2, 5],
      'subsample': [0.6, 0.8, 1.0],
      'colsample_bytree': [0.6, 0.8, 1.0],
      'max_depth': [3, 4, 5,7,10]}
  # GridSearchCVë¥¼ í†µí•´ parameterë¥¼ íƒìƒ‰í•˜ê²Œ ì •ì˜í•œë‹¤.
  XGB_OBP_gridsearch = GridSearchCV(xgb.XGBRegressor(random_state=42),
      param_grid=XGB_params, n_jobs=-1) 
  
  XGB_SLG_gridsearch = GridSearchCV(xgb.XGBRegressor(random_state=42),
      param_grid=XGB_params, n_jobs=-1)
  
  # ëª¨ë¸ í•™ìŠµ
  XGB_OBP_gridsearch.fit(OBP_train.iloc[:,-5:], OBP_train['OBP'])
  XGB_SLG_gridsearch.fit(SLG_train.iloc[:,-5:], SLG_train['SLG'])
  
  print(f"ê±¸ë¦°ì‹œê°„ : {np.round(time.time() - start,3)}ì´ˆ") # í˜„ì¬ì‹œê°„ â€“ ì‹œì‘ì‹œê°„(ë‹¨ìœ„ ì´ˆ)
  
  # ì‹¤í–‰ ê²°ê³¼
  ê±¸ë¦°ì‹œê°„ : 228.336ì´ˆ
  ```

#### ì•Œê³ ë¦¬ì¦˜ë³„ ì„±ëŠ¥ ë¹„êµ

* ì§€ê¸ˆê¹Œì§€ ë¦¿ì§€ íšŒê·€ ëª¨ë¸, ë¼ì˜ íšŒê·€ ëª¨ë¸, ëœë¤ í¬ë ˆìŠ¤íŠ¸, XGBoostì˜ 4ê°€ì§€ ëª¨ë¸ì„ ìƒì„± 

* ì´ì œ ì´ ëª¨ë¸ ì¤‘ ì–´ëŠ ëª¨ë¸ì´ ì´ë²ˆ ëŒ€íšŒì— ìµœì í™”ëœ ëª¨ë¸ì¸ì§€ ì°¾ì•„ë‚´ëŠ” ì‘ì—…ì„ ì§„í–‰

* ëª¨ë¸ì„ ì´ìš©í•´ í…ŒìŠ¤íŠ¸ ë°ì´í„°ì…‹ì¸ 2018ë…„ ë°ì´í„°ì— ëŒ€í•´ ì˜ˆì¸¡ì„ ì§„í–‰

* ëª¨ë¸ì˜ í‰ê°€ëŠ” ëŒ€íšŒì˜ ì„±ëŠ¥ í‰ê°€ì²™ë„ì¸ WRMSE ê°’ì„ í†µí•´ ì§„í–‰

* OPSë¥¼ ì´ ë£¨ëŠ” ë‘ ê°€ì§€ ì˜ì—­ì¸ ì¶œë£¨ìœ¨(OBP)ê³¼ ì¥íƒ€ìœ¨(SLG)ì¤‘ ì¶œë£¨ìœ¨ì„ ë¨¼ì € ë³¼ ê²ƒì„

* ì¶œë£¨ìœ¨ ì˜ˆì¸¡ ëª¨ë¸ ì„±ëŠ¥ ë¹„êµ

  ```python
  # í…ŒìŠ¤íŠ¸ ë°ì´í„°ì…‹(2018ë…„)ì˜ ì„ ìˆ˜ë“¤ì˜ OBPë¥¼ ì˜ˆì¸¡
  Lasso_OBP = OBP_linear_models['Lasso'].predict(OBP_test.iloc[:,-5:])
  Ridge_OBP = OBP_linear_models['Ridge'].predict(OBP_test.iloc[:,-5:])
  RF_OBP = OBP_RF_models['RF'].predict(OBP_test.iloc[:,-5:])
  XGB_OBP = XGB_OBP_gridsearch.predict(OBP_test.iloc[:,-5:])
  
  # test ë°ì´í„°ì˜ WRMSE ê³„ì‚°
  wrmse_score = [wrmse(OBP_test['OBP'], OBP_test['AB'], Lasso_OBP),
                 wrmse(OBP_test['OBP'], OBP_test['AB'], Ridge_OBP),
                 wrmse(OBP_test['OBP'], OBP_test['AB'], RF_OBP),
                 wrmse(OBP_test['OBP'], OBP_test['AB'], XGB_OBP)]
  
  x_lab = ['Lasso', 'Ridge', 'RF', 'XGB']
  
  plt.bar(x_lab, wrmse_score)
  plt.title('WRMSE of OBP', fontsize=20)
  plt.xlabel('model', fontsize=18)
  plt.ylabel('', fontsize=18)
  plt.ylim(0,0.5)
  
  # ë§‰ëŒ€ê·¸ë˜í”„ ìœ„ì— ê°’ì„ í‘œì‹œí•´ì¤€ë‹¤.
  for i, v in enumerate(wrmse_score):
      plt.text(i-0.1, v + 0.01, str(np.round(v,3))) # x ì¢Œí‘œ, y ì¢Œí‘œ, í…ìŠ¤íŠ¸ë¥¼ í‘œí˜„í•œë‹¤.
      
  plt.show()
  ```

  ![image-20220408124422949](/images/2022-04-08-dacon-2st/image-20220408124422949.png)

* ëª¨ë¸ ê²€ì¦ ê²°ê³¼ ë¼ì˜ íšŒê·€ ëª¨ë¸ì€ 0.325, ë¦¿ì§€íšŒê·€ ëª¨ë¸ì€ 0.33, ëœë¤ í¬ë ˆìŠ¤íŠ¸ëŠ” 0.323. XGBoostëŠ” 0.394ì˜ WRMSE ìˆ˜ì¹˜ë¥¼ ê¸°ë¡

* ëŒ€íšŒ í‰ê°€ì²™ë„ì¸ WRMSEëŠ” ìˆ«ìê°€ ë‚®ì„ìˆ˜ë¡ ì¢‹ì€ ì„±ëŠ¥ì„ ì˜ë¯¸í•œë‹¤ëŠ” ê²ƒì„ ê¸°ì–µí•  ê²ƒ

* ì¶œë£¨ìœ¨ ì˜ˆì¸¡ì„ ìœ„í•œ ëª¨ë¸ì„ ì‚´í´ë³¸ ê²°ê³¼, XGBoostê°€ ê°€ì¥ ì•ˆ ì¢‹ì€ ì„±ëŠ¥ì„ ë³´ì—¬ì£¼ê³  ìˆìœ¼ë©° ëœë¤ í¬ë ˆìŠ¤íŠ¸ê°€ ê°€ì¥ ì¢‹ì€ ì„±ëŠ¥ì„ ë³´ì—¬ì¤Œ.

* ë‹¤ë§Œ, ê° ëª¨ë¸ë³„ ì„±ëŠ¥ì˜ êµ¬ì²´ì ì¸ ìˆ˜ì¹˜ëŠ” ì°¨ì´ê°€ ìˆì„ ìˆ˜ ìˆìŒ.

* ëŒ€íšŒë¥¼ ì§„í–‰í•  ë‹¹ì‹œ ë°ì´í„°ì™€ í˜„ì¬ ë°ì´ì½˜ì—ì„œ ì œê³µë˜ëŠ” ë°ì´í„°ì— ë‹¤ì†Œ ì°¨ì´ê°€ ìˆê¸° ë•Œë¬¸

* ì´ë²ˆ ì˜ˆì œì—ì„œëŠ” ëŒ€íšŒ ë‹¹ì‹œì˜ ëª¨ë¸ ì„±ëŠ¥ì„ ê¸°ë°˜ìœ¼ë¡œ ë¶„ì„ íë¦„ì„ ì–´ë–»ê²Œ ê°€ì ¸ê°”ëŠ”ì§€ ì§‘ì¤‘í•´ì„œ ì‚´í´ë³´ê² ìŒ. 

* ë‹¤ìŒìœ¼ë¡œ ì¥íƒ€ìœ¨(SLG)ì„ ì˜ˆì¸¡í•˜ì—¬ ê·¸ ê²°ê³¼ë¥¼ ë¹„êµ

* ì¥íƒ€ìœ¨(SLG) ì˜ˆì¸¡ ëª¨ë¸ ì„±ëŠ¥ ë¹„êµ

  ```python
  # í…ŒìŠ¤íŠ¸ ë°ì´í„°ì…‹(2018ë…„)ì˜ ì„ ìˆ˜ë“¤ì˜ SLGë¥¼ ì˜ˆì¸¡
  Lasso_SLG = SLG_linear_models['Lasso'].predict(SLG_test.iloc[:,-5:])
  Ridge_SLG = SLG_linear_models['Ridge'].predict(SLG_test.iloc[:,-5:])
  RF_SLG = SLG_RF_models['RF'].predict(SLG_test.iloc[:,-5:])
  XGB_SLG = XGB_SLG_gridsearch.predict(SLG_test.iloc[:,-5:])
  
  # testë°ì´í„° WRMSE ê³„ì‚°
  wrmse_score_SLG = [wrmse(SLG_test['SLG'], SLG_test['AB'], Lasso_SLG),
                     wrmse(SLG_test['SLG'], SLG_test['AB'], Ridge_SLG), 
                     wrmse(SLG_test['SLG'], SLG_test['AB'], RF_SLG),
                     wrmse(SLG_test['SLG'], SLG_test['AB'], XGB_SLG)]
  
  x_lab = ['Lasso', 'Ridge', 'RF', 'XGB']
  
  plt.bar(x_lab, wrmse_score_SLG)
  plt.title('WRMSE of SLG', fontsize=20)
  plt.xlabel('model', fontsize=18)
  plt.ylabel('', fontsize=18)
  plt.ylim(0, 0.9)
  
  # ë§‰ëŒ€ê·¸ë˜í”„ ìœ„ì— ê°’ì„ í‘œì‹œí•´ì¤€ë‹¤.
  for i, v in enumerate(wrmse_score_SLG):
      plt.text(i-0.1, v + 0.01, str(np.round(v,3))) # x ì¢Œí‘œ, y ì¢Œí‘œ, í…ìŠ¤íŠ¸ë¥¼ í‘œí˜„í•œë‹¤.
  plt.show()
  ```

  ![image-20220408124429480](/images/2022-04-08-dacon-2st/image-20220408124429480.png)

* ì´ë ‡ê²Œ í•´ì„œ SLG ì˜ˆì¸¡ì˜ ëª¨ë¸ ì„±ëŠ¥ì„ í‰ê°€

* ëª¨ë¸ ê²€ì¦ ê²°ê³¼ ë¼ì˜ íšŒê·€ ëª¨ë¸ì€ 0.674, ë¦¿ì§€ íšŒê·€ ëª¨ë¸ì€ 0.677, ëœë¤ í¬ë ˆìŠ¤íŠ¸ëŠ” 0.7, XGBoostëŠ” 0.793ì˜ WRMSE ìˆ˜ì¹˜ ë¥¼ ê¸°ë¡

* XGBoostê°€ ê°€ì¥ ì•ˆ ì¢‹ì€ ì„±ëŠ¥ì„ ë³´ì—¬ì£¼ê³  ìˆìœ¼ë©° ë¼ì˜ íšŒê·€ ëª¨ë¸ì´ ê°€ì¥ ì¢‹ì€ ì„±ëŠ¥ì„ ë³´ì—¬ì¤Œ

* ì¥íƒ€ìœ¨ ì—­ì‹œ ì¶œë£¨ìœ¨ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ëª¨ë¸ë³„ êµ¬ì²´ì  ìˆ˜ì¹˜ì—ëŠ” ì°¨ì´ê°€ ìˆì„ ìˆ˜ ìˆìŒ

### 4_3 ê²°ê³¼ í•´ì„ ë° í‰ê°€

#### ëœë¤ í¬ë ˆìŠ¤íŠ¸

* ì•ì˜ ë‹¨ê³„ë¥¼ í†µí•´ ê³¼ê±° ì„±ì ì„ ê¸°ë°˜ìœ¼ë¡œ ë¯¸ë˜ ì„±ì ì„ ì˜ˆì¸¡í•˜ëŠ” ëª¨ë¸ì„ êµ¬ì¶•

* ëª¨ë¸ì„ êµ¬ì¶•í–ˆìœ¼ë¯€ë¡œ ì´ì œëŠ” ì–´ë–¤ ë³€ìˆ˜ê°€ ëª¨ë¸ ì„±ëŠ¥ì— ë§ì€ ì˜í–¥ì„ ë¼ì¹˜ëŠ”ì§€ íŒŒì•… ê°€ëŠ¥

* ëœë¤ í¬ë ˆìŠ¤íŠ¸ì™€ ê°™ì€ íŠ¸ë¦¬ ê¸°ë°˜ ëª¨ë¸ì—ì„œëŠ” ë³€ìˆ˜ ì¤‘ìš”ë„ë¥¼ ì‰½ê²Œ íŒŒì´ì¬ í™˜ê²½ì—ì„œ ë„ì¶œ ê°€ëŠ¥

* ê° ë³€ìˆ˜ì˜ ì¤‘ìš”ë„ì— ë”°ë¼ ì´ë¥¼ ë˜ ë‹¤ì‹œ í™œìš©í•  ìˆ˜ë„ ìˆìœ¼ë¯€ë¡œ ì¶œë£¨ìœ¨ê³¼ ì¥íƒ€ìœ¨ ê°ê° ì— ëŒ€í•œ ëœë¤ í¬ë ˆìŠ¤íŠ¸ ëª¨ë¸ì—ì„œì˜ ë³€ìˆ˜ ì¤‘ìš”ë„ë¥¼ í™•ì¸

* ëœë¤ í¬ë ˆìŠ¤íŠ¸ ëª¨ë¸ì—ì„œì˜ ë³€ìˆ˜ ì¤‘ìš”ë„

  ```python
  plt.figure(figsize=(15,6)) # ê·¸ë˜í”„ì˜ í¬ê¸° ì§€ì •
  plt.subplot(1,2,1) # 1í–‰ 2ì—´ì˜ ì²«ë²ˆì§¸(1,1) ê·¸ë˜í”„
  
  #ê°€ë¡œë§‰ëŒ€ ê·¸ë˜í”„
  plt.barh(OBP_train.iloc[:,-5:].columns,OBP_RF_models['RF'].feature_importances_) 
  
  plt.title('Feature importance of RF in OBP')
  plt.subplot(1,2,2) # 1í–‰ 2ì—´ì˜ ë‘ë²ˆì§¸(1,2) ê·¸ë˜í”„
  plt.barh(SLG_train.iloc[:,-5:].columns,SLG_RF_models['RF'].feature_importances_)
  plt.title('Feature importance of RF in SLG')
  plt.show()
  ```

  ![image-20220408124435720](/images/2022-04-08-dacon-2st/image-20220408124435720.png)

* ëœë¤ í¬ë ˆìŠ¤íŠ¸ì˜ ë³€ìˆ˜ ì¤‘ìš”ë„ë¥¼ í™•ì¸í•œ ê²°ê³¼ ì¶œë£¨ìœ¨ê³¼ ì¥íƒ€ìœ¨ ëª¨ë‘ í‰ê·  ê¸°ë¡ì´ ê°€ì¥ ë†’ì€ ìˆ˜ì¹˜ë¥¼ ê¸°ë¡

* ì´ëŠ” ì˜ˆì¸¡ ì„±ëŠ¥ì— ìˆì–´ í‰ê·  ì¶œë£¨ìœ¨ ë° í‰ê·  ì¥íƒ€ìœ¨ì´ ê°€ì¥ í¬ê²Œ ì˜í–¥ì„ ë¯¸ì¹œë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸

* ê·¸ ë’¤ë¥¼ ì´ì–´ OBPì—ì„œëŠ” 1 ë…„ ì „ ì„±ì , 2ë…„ ì „ ì„±ì  ìˆœì„œë¡œ SLG ì—ì„œëŠ” ë‚˜ì´,  1 ë…„ ì „ ì„±ì  ìˆœì„œë¡œ ë†’ì€ ë³€ìˆ˜ ì¤‘ìš”ë„ë¥¼ ë³´ì„.

#### ë¼ì˜ì™€ ë¦¿ì§€ íšŒê·€ ëª¨ë¸

* ë¼ì˜ íšŒê·€ ëª¨ë¸ê³¼ ë¦¿ì§€ íšŒê·€ ëª¨ë¸ì€ ê²°ê³¼ì˜ í•´ì„ì— ìˆì–´ ì¥ì ì´ ìˆë‹¤ê³  í•¨.

* ì´ë²ˆ ë¶„ì„ ì—ì„œë„ alpha ê°’ê³¼ ê³„ìˆ˜ì˜ ê°’ì„ í†µí•´ ê° ë³€ìˆ˜ì˜ ì¤‘ìš”ì„±ì— ëŒ€í•´ í•´ì„

* ê³„ìˆ˜ëŠ” ê° ë³€ìˆ˜ì— ê³±í•´ì§€ëŠ” ê°€ì¤‘ì¹˜ë¥¼ ì˜ë¯¸í•˜ë©° alpha ê°’ì€ í˜ë„í‹°ì˜ ì •ë„ë¥¼ ì˜ë¯¸

* ë¼ì˜ ëª¨ë¸ì˜ alpha ê°’ê³¼ ì„ í˜• ê³„ìˆ˜ ê°’

  ```python
  # Lassoì—ì„œ GridSearchCVë¡œ íƒìƒ‰í•œ ìµœì ì˜ alphaê°’ ì¶œë ¥
  print('Alpha : ', OBP_linear_models['Lasso'].alpha) 
  # Lasso modelì˜ ì„ í˜• ê³„ìˆ˜ ê°’ ì¶œë ¥
  display(pd.DataFrame(OBP_linear_models['Lasso'].coef_.reshape(-1, 5),
                       columns=OBP_train.iloc[:,-5:].columns, index = ['coefficient']))
  
  print('Alpha : ', SLG_linear_models['Lasso'].alpha)
  display(pd.DataFrame(SLG_linear_models['Lasso'].coef_.reshape(-1, 5),
                       columns=SLG_train.iloc[:,-5:].columns, index = ['coefficient']))
  
  # ì‹¤í–‰ ê²°ê³¼
  Alpha :  0.0001
  age	lag1_OBP	lag2_OBP	lag3_OBP	mean_OBP
  coefficient	0.003195	0.018249	0.0	0.0	0.864913
  Alpha :  0.0001
  age	lag1_SLG	lag2_SLG	lag3_SLG	mean_SLG
  coefficient	0.0049	0.081209	0.0	-0.0	0.836453
  ```

* ìš°ì„  ì¶œë£¨ìœ¨ì—ì„œëŠ” í‰ê·  ì„±ì ê³¼ ë‚˜ì´ë§Œ ì´ìš©í•˜ëŠ” ê²ƒ, ì¥íƒ€ìœ¨ì—ì„œëŠ” í‰ê·  ì„±ì ê³¼ ë‚˜ì´, 1 ë…„ ì „ ì„±ì ì„ ì´ìš©í•˜ëŠ” ê²ƒì´ ê°€ì¥ ì¢‹ì€ ëª¨ë¸ì´ë¼ëŠ” ê²°ë¡ ì´ ë„ì¶œ

* ì‹œê°í™”ë¥¼ í†µí•´ í•™ìŠµ ê³¼ì • ì„ ë” ìì„¸í•˜ê²Œ ë´„.

* ë¼ì˜ ì‹œê°í™”

  ```python
  from sklearn.linear_model import lars_path
  plt.figure(figsize=(15,4.8)) # ê·¸ë˜í”„ í¬ê¸° ì§€ì •
  plt.subplot(1,2,1) # 1í–‰ 2ì—´ì˜ ì²« ë²ˆì§¸(1í–‰, 1ì—´) ê·¸ë˜í”„ 
  
  # OBP ëª¨ë¸ì˜ alpha ê°’ì˜ ë³€í™”ì— ë”°ë¥¸ ê³„ìˆ˜ì˜ ë³€í™”ë¥¼ alpha, coefsì— ì €ì¥í•œë‹¤.
  alphas, _, coefs = lars_path(OBP_train.iloc[:,-5:].values, OBP_train['OBP'],
                               method='lasso', verbose=True)
  
  # í”¼ì²˜ë³„ alpha ê°’ì— ë”°ë¥¸ ì„ í˜• ëª¨ë¸ ê³„ìˆ˜ì˜ ì ˆëŒ“ê°’ì˜ í•© 
  xx = np.sum(np.abs(coefs.T), axis=1)
  # ê³„ìˆ˜ì˜ ì ˆëŒ“ê°’ ì¤‘ ê°€ì¥ í° ê°’ìœ¼ë¡œ alphaì— ë”°ë¥¸ í”¼ì²˜ì˜ ê³„ìˆ˜ì˜ í•©ì„ ë‚˜ëˆˆë‹¤. 
  xx /= xx[-1]
  
  plt.plot(xx, coefs.T)
  plt.xlabel('|coef| / max|coef|')
  plt.ylabel('Coefficients')
  plt.title('OBP LASSO Path')
  plt.axis('tight')
  plt.legend(OBP_train.iloc[:,-5:].columns)
  
  plt.subplot(1,2,2) # 1í–‰ 2ì—´ì˜ ë‘ ë²ˆì§¸(1í–‰, 2ì—´) ê·¸ë˜í”„
  # SLG ëª¨ë¸ì—ì„œ alpha ê°’ì˜ ë³€í™”ì— ë”°ë¥¸ ê³„ìˆ˜ì˜ ë³€í™”ë¥¼ alpha, coefsì— ì €ì¥í•œë‹¤.
  alphas, _, coefs = lars_path(SLG_train.iloc[:,-5:].values, SLG_train['SLG'],
                               method='lasso', verbose=True)
  xx = np.sum(np.abs(coefs.T), axis=1)
  xx /= xx[-1]
  
  plt.plot(xx, coefs.T)
  plt.xlabel('|coef| / max|coef|')
  plt.ylabel('Coefficients')
  plt.title('SLG LASSO Path')
  plt.axis('tight')
  plt.legend(OBP_train.iloc[:,-5:].columns)
  plt.show()
  ```

  ![image-20220408124441889](/images/2022-04-08-dacon-2st/image-20220408124441889.png)

* ê·¸ë˜í”„ì˜ ì™¼ìª½ìœ¼ë¡œ ê°ˆìˆ˜ë¡ íŒ¨ë„í‹° ê°’ì´ ì»¤ì ¸ ê³„ìˆ˜ê°€ 0ìœ¼ë¡œ ìˆ˜ë ´í•˜ê³  ìˆìŒ

* ì¶œë£¨ìœ¨(OBP) ì˜ˆì¸¡ ëª¨ë¸ì—ì„œëŠ” 1. 2, 3ë…„ ì „ ì„±ì ì´ ë¨¼ì € 0ìœ¼ë¡œ ìˆ˜ë ´í•˜ê³  ê·¸ ë’¤ì— ë‚˜ì´, ê·¸ë¦¬ê³  í•œì°¸ ë’¤ í‰ ê·  ì„±ì ì´ 0ìœ¼ë¡œ ìˆ˜ë ´

* SLG ëª¨í˜•ì—ì„œëŠ” 2, 3ë…„ ì „ ì„±ì ì´ ë‹¤ë¥¸ ê°’ë“¤ë³´ë‹¤ ë¨¼ì € 0ìœ¼ë¡œ ìˆ˜ë ´í•˜ê³  ê·¸ ë’¤ì— 1ë…„ ì „ ì„±ì , ë‚˜ì´, í‰ê·  ì„±ì  ìˆœì„œë¡œ 0ì— ìˆ˜ë ´

* ì´ë¥¼ ë³´ë©´ 2, 3ë…„ ì „ ì„±ì ì€ ì„ í˜• ëª¨ë¸ì—ì„œ ì¤‘ìš”í•˜ê²Œ ì“°ì´ì§€ ì•Šê³  í‰ê·  ì„±ì ì´ ê°€ì¥ ì¤‘ìš”í•˜ê²Œ í™œìš©
